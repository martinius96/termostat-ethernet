<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Primary Meta Tags -->
	<title>Room thermostat - Arduino - Ethernet Wiznet W5100 - Webserver</title>
	<meta name="description" content="Room thermostat designed on the Arduino Uno platform + Ethernet shield Wiznet W5100 / W5500. Thermostat for heating / cooling.">
	<meta name="keywords" content="Thermostat, digital, arduino, wiznet, ethernet, w5100, w5500, heating, heating, webserver, socket, http, web, ip, ipv4, ds18b20, onewire, 1-wire">
	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://martinius96.github.io/termostat-ethernet/en/">
	<meta property="og:title" content="Room thermostat - Arduino - Ethernet Wiznet W5100 - Webserver">
	<meta property="og:description" content="Room thermostat designed on the Arduino Uno platform + Ethernet shield Wiznet W5100 / W5500. Thermostat for heating / cooling.">

	<!-- Twitter -->
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:url" content="https://martinius96.github.io/termostat-ethernet/en/">
	<meta property="twitter:title" content="Room thermostat - Arduino - Ethernet Wiznet W5100 - Webserver">
	<meta property="twitter:description" content="Room thermostat designed on the Arduino Uno platform + Ethernet shield Wiznet W5100 / W5500. Thermostat for heating / cooling.">
	
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="sitemap" type="application/xml" title="Sitemap" href="../../sitemap.xml" />
	<meta name="google-site-verification" content="UwZZh2EXv3iWUAi_1Z0hLxVCz6ySJ4UdY_BPoLtejwo" />    	
	<meta property='fb:admins' content='100001242570317'>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script type="text/javascript">
    		window.smartlook||(function(d) {
    			var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];
    			var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';
    			c.charset='utf-8';c.src='https://rec.smartlook.com/recorder.js';h.appendChild(c);
    		})(document);
    		smartlook('init', 'db50efe9fff280a17db52b82be221240cbbd3dbe');
	</script>    
			<style>
	#right {
  position: absolute;
  right: 0px;
}
	</style>
</head>
<body>
	<div class="container">
  		<div class="row">
    			<div class="col-sm-12">
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Thermostat - Ethernet</a>
    </div>
    <ul class="nav navbar-nav">
      	<li class="active"><a href="index.html">Overview</a></li>
	<li><a href="zapojenie.html">Involvement</a></li>      
	<li class=""><a href="spustenie.html">Firmware</a></li>
  <li><a href="json_client.html">JSON client</a></li>
      	<li><a href="kontakt.html">Contact</a></li>
<a href="../de/index.html"><img src="https://futbalovysen.sk/wp-content/uploads/germany.png" alt="Germany.png, 2,2kB" title="Germany" height="32" width="32"></a>	
<a href="../index.html"><img src="https://futbalovysen.sk/wp-content/uploads/slovakia.png" alt="Slovak flag.png, 2,2kB" title="Slovakia" height="32" width="32"></a>   
	 <li style="float: right; "><a href="https://martinius96.github.io/WiFi-termostat/en/" class="btn btn-success" role="button" title="Zmeniť projekt na WiFi termostat"><img src="https://www.flaticon.com/premium-icon/icons/svg/3686/3686730.svg" width=16px height=16px> <font color="white">WiFi thermostat</font></a></li> 
</ul>
  </div>
</nav>  
<div class="alert alert-success">
	<strong>Ethernet thermostat project repository - machine codes: </strong><a href="https://github.com/martinius96/termostat-ethernet/tree/master/firmware">Github</a>
</div>	
<div class="alert alert-danger">
	<strong>Version 1.0.4 of the Ethernet thermostat project is the latest free version update. Other bugs, bugs and security bugs will not be resolved!</strong>
</div>		
<div class="alert alert-success">
	<strong>Firmware for the Ethernet thermostat is fully available in English language.</strong>
</div>		
<div class="alert alert-info">
 	<strong>Support the Ethernet thermostat project via PayPal. Support will allow you to add new features in the future and open the source code of the application: </strong><a href="https://www.paypal.com/paypalme/chlebovec" class="btn btn-primary" role="button">PayPal donate</a>
</div>			
<span class="label label-default">Arduino</span>
<span class="label label-primary">Ethernet</span>
<span class="label label-success">Wiznet W5100 / W5500</span>
<span class="label label-info">DS18B20</span>
<span class="label label-warning">OneWire</span>
<span class="label label-danger">Dallas</span>
<span class="label label-default">HTML</span>
<span class="label label-primary">Webserver</span>
<span class="label label-success">WebSocket</span>
<hr><h4>Compatible control hardware for Ethernet thermostat:</h4><hr>
<div class="row">
<div class="col-sm-3"><center><img src="https://i.imgur.com/wtnzKqO.png" width="128px" height="128px" style="border-radius: 50%;" alt="Control microcontroller Arduino UNO" title="Control microcontroller Arduino UNO"><br><b><a href="https://www.ebay.com/itm/254532156570">Arduino UNO</a></b></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/XHC8DBe.png" width="128px" height="128px" style="border-radius: 50%;" alt="Control microcontroller Arduino Nano" title="Control microcontroller Arduino Nano"><br><b><a href="https://www.ebay.com/itm/252742123829">Arduino Nano</a></b></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/4xX0BoE.png" width="128px" height="128px" style="border-radius: 50%;" alt="Control microcontroller ATmega328P DIP" title="Control microcontroller ATmega328P DIP"><br><b><a href="https://www.ebay.com/itm/292204064766">ATmega328P - DIP28</a></b></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/FANTMuW.png" width="128px" height="128px" style="border-radius: 50%;" alt="Control microcontroller ATmega328P SMD" title="Control microcontroller ATmega328P SMD"><br><b><a href="https://www.ebay.com/itm/142666414237">ATmega328P - SMD</a></b></center></div>
</div>	
<hr><h4>Compatible Ethernet modules and shields for Ethernet thermostat:</h4><hr>
<div class="row">
<div class="col-sm-3"><center><img src="https://i.imgur.com/aaS35X2.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet shield Wiznet W5100" title="Ethernet shield Wiznet W5100"><br><b><a href="https://www.ebay.com/itm/185017231005">Ethernet Wiznet W5100</a></b></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/GaZYxl0.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet modul Wiznet W5200" title="Ethernet modul Wiznet W5200"><br><b><a href="https://www.ebay.com/itm/324571412234">Ethernet Wiznet W5200</a></b></center></div> 
<div class="col-sm-3"><center><img src="https://i.imgur.com/rME7SWd.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet modul Wiznet W5200" title="Ethernet modul Wiznet W5300"><br><b><a href="https://www.ebay.com/itm/113814097639">Ethernet Wiznet W5300</a></b></center></div>   
<div class="col-sm-3"><center><img src="https://i.imgur.com/mz4dhRA.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet modul Wiznet W5500" title="Ethernet modul Wiznet W5500"><br><b><a href="https://www.ebay.com/itm/263116282333">Ethernet Wiznet W5500</a></b></center></div>
</div>				
<hr><center><h1>Room thermostat - Arduino + Ethernet</h1></center><hr>
<p style="text-align: justify;">
Arduino is a handy embeeded platform that can be used, for example, to build a room thermostat, which we will show today.
The implementation uses Arduino in combination with the Ethernet shield Wiznet W5100, which works in web server mode and can receive requests from clients in the network via HTTP protocol and send a response to them - HTML code.
The thermostat is accessible from the LAN network in which it is located, while it is equipped with a web interface which is used to configure all elements of the thermostat.
The web server allows the running of several independent HTML pages, which can be informative or even functional. The web server runs on port 80 - HTTP.
The thermostat can automatically control the signaling relay for switching on the gas boiler via the output. It can thus replace an existing room thermostat.
As a decision algorithm, the target temperature with hysteresis is used, which is compared with the measured temperature from the digital temperature sensor Dallas DS18B20.
<b> The resolution of the DS18B20 sensor when measuring is 12-bits, which is indicated by the resolution at 0.0625 ° C. Data via the OneWire bus can arrive in the microcontroller on demand in 500 to 1000 ms. </b>
The decision logic of the system is executed every 10 seconds independently of the web server, no keep-alive connection is required to execute the logic, the system thus operates autonomously and does not require the user's attention.
</p>
<b>In terms of hardware, the project uses:</b>
<li>Arduino Uno</li>
<li>Ethernet shield Wiznet W5100 / Ethernet module Wiznet W5200-W5500</li>
<li>DS18B20 temperature sensor on the OneWire bus in a TO-92 housing, or in a waterproof version in an aluminum tube</li>
<li>Electromagnetic relay SRD-5VDC-SL-C / SSR relay OMRON G3MB-202P used for boiler switching (Active-LOW signal)</li>
<p style="text-align: justify;">
<b>HTML pages running on Arduino:</b>
<li><b>/</b> - root page containing the form, current listing of logic output for the relay, temperature</li>
<li><b>/action.html</b> - processes values from the form, writes them to the EEPROM memory, redirects the user back to the root page</li>
<li><b>/get_data.json</b> - distributes data on current temperature, reference temperature and hysteresis to a third party (computer, microcontroller, other client ...) in JSON format</li>
<hr>				
The electromagnetic relay SRD-5VDC-SL-C, which is used in the project, allows switching up to 10A at 230V - maximum power 2300W.
In case of switching a DC circuit (load) it is possible to switch 300W (10A at 30V DC max).
The OMRON G3MB-202P SSR relay is also fully compatible for the wiring diagram, which is suitable only for non-inductive loads and exclusively for AC loads (DC circuit cannot open after switching on).
Maximum switching power 460W (230V, 2A). <b> The thermostat can be used all year round. In case of unnecessary control, the output can be physically disconnected and the thermostat can be used as an Ethernet thermometer to obtain data from the room where it is located. </b>
</p>

<b> The web interface for the Ethernet thermostat allows you to: </b>
<li> View in real time the temperature from the DS18B20 sensor, the device uptime, the output value with dynamic change, the currently set configuration data for the thermostat, i. target temperature and hysteresis </li>
<li> Modify the target (reference) temperature <del>from 5 to 50 °C with 0.25 °C step</del> <img src="https://i.imgur.com/zMsp0cr.png" width="20px" height="20px" data-toggle="tooltip2" data-placement="right" title="Scope removed in version 1.0.2 due to non-decimal point support for input type number on Android OS"></li>
<li> Modify hysteresis <del>from 0 to 10 °C with 0.25 °C step</del> <img src="https://i.imgur.com/zMsp0cr.png" width="20px" height="20px" data-toggle="tooltip2" data-placement="right" title="Scope removed in version 1.0.2 due to non-decimal point support for input type number on Android OS"></li>

<b> Boiler ON / OFF control: </b>
<li> Example of ON / OFF of heating control - <font color="red"> VISUALIZATION IS NOT PART OF THE PROJECT </font> </li>
<li> The boiler is active as long as the target temperature + hysteresis is reached </li>
<li> The visualization of water temperatures shows the so-called heating run and subsequent cooling of the water until the heating activity is repeated, when the measured temperature is below the set target temperature - hysteresis </li>
<img src="https://i.imgur.com/IDWLuOr.png" style="display: block; max-width: 100%; height: auto;" alt="ZAP/VYP regulácia kotla s hysterézou" title="ZAP/VYP regulácia kotla s hysterézou">        			    
<p style="text-align: justify;">
The web interface is designed to adapt to larger and smaller screens. It is responsive, supports widescreen high-definition screens, but also mobile devices.
The interface uses imported CSS styles of the Bootstrap framework from an external CDN server, which loads the client-side device when opening a page running on Arduino.
Because the Arduino Uno is memory limited, it can only run pages a few kB in size. By importing CSS styles from an external server, it allows you to reduce the performance and memory load of Arduino.
The software implementation (for Arduine Uno) uses about 70% of flash memory (32kB - 4kB Bootloader) and 44% of RAM memory (2kB).
Static parts of a web page (HTML document header and footer, Bootstrap CSS linking, meta tags, HTTP response header, Content Type, form and more) are stored directly in Arduino's flash memory, which can significantly reduce the amount of RAM used for user-generated content.
The web server is thus more stable and can handle multi-connection of several devices in the network at the same time. Consumption of the whole thermostat is up to 200 mA at 5V supply - below 1W.
</p>
<hr>
<p style="text-align: justify;">
In order to keep the set values even after a power failure, they are stored in the EEPROM memory of the Arduino.
The reference temperature is written to offset 10, hysteresis to offset 100. Each of the values occupies a maximum of 5B in the EEPROM memory + terminator.
The EEPROM transcription limit is at the level of 100,000 transcripts. Data is overwritten only when the HTML form is submitted. The operation of the thermostat is thus extremely gentle on the EEPROM memory in order to maximize its service life.
If the device has nothing stored on the mentioned EEPROM offsets at the first start-up, automatic writing will be performed with default values - reference: 20.25 ° C, hysteresis 0.25 ° C, so-called fail-safe solution so that the thermostat is immediately functional and ready for operation.
</p>
<p style="text-align: justify;">
Using the Refresh meta tag, the web server refreshes the entire page every 30 seconds, and the approximate time to refresh is also written to the HTML page via Javascript.
By this time it is necessary to write the change for the thermostat, otherwise the input windows for numerical inputs to the form will be reset when the page is refreshed. <b> Based on feedback from Android device users, the time for Refresh has been extended from 10 to 30 seconds. </b>
As the built-in Ethernet library does not include the use of an asynchronous web server (which can be used, for example, with the Espressif ESP8266 / ESP32 microcontrollers), it is necessary to rewrite the entire page.
The dynamic data that is mainly changing is the current value of the output - <b> <font color = "#27AE60"> On </font> </b> / <b> <font color = "red"> Off </font> </b>, which informs the operator about the actual state of the output together with the color coding.
Since the system logic is executed independently of the web server, the output may already be in a different state than currently currently listed in the web application. The change of output is immediately written to the UART monitor (115200 baud/s), for example.
On the thermostat's website, the user will also find information about the device's uptime (how long it has been running), i. time in days, hours, minutes and seconds.
</p>
<div class="alert alert-danger">
	<strong>The author of the Ethernet thermostat is not responsible for the functionality of the thermostat, boiler failure, electric shock due to improper installation of the thermostat in the network.</strong> The thermostat is distributed under the MIT license.
</div>	
<b>Main page for modification of target temperature and hysteresis - example of switched on output:</b>
<div class="alert alert-info">
	<strong>Sample data</strong>
	<li><b>Target temperature:</b>  22.75 °C</li>
	<li><b>Hysteresis:</b>  0.25 °C</li>
	<li><b>Measured temperature:</b>  22.49 °C</li>
	<li><b>Output:</b>  <font color="#27AE60">Turned on</font></li>
	<hr>
	<p style="text-align: justify;">
The thermostat heats from a measured temperature of 22.49 ° C and below.
If the temperature reaches 23.01 °C, the output is switched off, the signaling relay opens and the gas boiler stops heating.
The heating and cooling of the room in which the measurements are performed takes place. The thermostat is not reactivated until the temperature reaches 22.49 °C or lower.
	</p>	
</div>
<img src="https://i.imgur.com/T7HmUrF.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - Main dashboard - Arduino" title="Ethernet thermostat - Main dashboard - Arduino">        			
<b>Process of processing the entered data (user redirection) with VALID and NOT VALID datas:</b>
<img src="https://i.imgur.com/NjeXt4R.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - processing HTML form with valid datas" title="Ethernet thermostat - processing HTML form with valid datas">  
<img src="https://i.imgur.com/2T1P1Qd.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - processing HTML form without valid datas" title="Ethernet thermostat - processing HTML form without valid datas">       			
<b>JSON web server output in browser / client via websocket:</b>
<center><img src="https://i.imgur.com/XuJWC2a.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - JSON output" title="Ethernet thermostat - JSON output"></center>        		
<b>Output to UART monitor - system logic + Ethernet adapter settings:</b>
<center><img src="https://i.imgur.com/KQYrn4R.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - UART" title="Ethernet thermostat - UART"></center>        		
<hr>
<h3><font color="#2ECC71">Source code - Ethernet thermostat - automatic</font></h3>	
<pre style="background-color:#2ECC71;">
/*|----------------------------------------------------------|*/
/*|HTTP webserver - Ethernet thermostat, Wiznet W5100 / W5500|*/
/*|Arduino Uno / Nano / Mega compatible (R3)                 |*/
/*|AUTHOR: Martin Chlebovec                                  |*/
/*|EMAIL: martinius96@gmail.com                              |*/
/*|DONATE: paypal.me/chlebovec                               |*/
/*|----------------------------------------------------------|*/

#include &lt;avr\wdt.h>
#include &lt;SPI.h>
#include &lt;Ethernet.h> //FOR Wiznet W5100
//#include &lt;Ethernet2.h> //FOR Wiznet W5500
#include &lt;EEPROM.h>
#include &lt;OneWire.h>
#include &lt;DallasTemperature.h>

#define ONE_WIRE_BUS 5
OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensorsA(&oneWire);
const int rele = 6;
byte mac[] = { 0xDE, 0xAD, 0xBB, 0xEF, 0xFE, 0xAE }; //physical mac address
byte ip[] = { 192, 168, 4, 1 };
EthernetServer server(80); //server port
const char terminator1[2] = " ";
const char terminator3[2] = "?";
const char terminator4[2] = "&";
const char terminator5[2] = "=";
unsigned long cas = 0;

long day = 86400000; // 86400000 milliseconds in a day
long hour = 3600000; // 3600000 milliseconds in an hour
long minute = 60000; // 60000 milliseconds in a minute
long second =  1000; // 1000 milliseconds in a second

float teplota;
String stav;

boolean isFloat(String tString) {
  String tBuf;
  boolean decPt = false;

  if (tString.charAt(0) == '+' || tString.charAt(0) == '-') tBuf = &tString[1];
  else tBuf = tString;

  for (int x = 0; x &lt; tBuf.length(); x++)
  {
    if (tBuf.charAt(x) == '.') {
      if (decPt) return false;
      else decPt = true;
    }
    else if (tBuf.charAt(x) &lt; '0' || tBuf.charAt(x) > '9') return false;
  }
  return true;
}


void writeString(char add, String data)
{
  int _size = data.length();
  int i;
  for (i = 0; i &lt; _size; i++)
  {
    EEPROM.write(add + i, data[i]);
  }
  EEPROM.write(add + _size, '\0'); //Add termination null character for String Data
}


String read_String(char add)
{
  int i;
  char data[100]; //Max 100 Bytes
  int len = 0;
  unsigned char k;
  k = EEPROM.read(add);
  while (k != '\0' && len &lt; 500) //Read until null character
  {
    k = EEPROM.read(add + len);
    data[len] = k;
    len++;
  }
  data[len] = '\0';
  return String(data);
}

void setup() {
  String a = read_String(10);
  String b = read_String(100);
  if (a == "" || a == NULL) {
    writeString(100, "20.25");
  }
  if (b == "" || b == NULL) {
    writeString(10, "0.25");
  }
  sensorsA.begin();
  pinMode(rele, OUTPUT);
  digitalWrite(rele, HIGH);
  Serial.begin(115200);
  sensorsA.requestTemperatures();
  delay(2000);
  // Ethernet.begin(mac); //FOR DHCP
  Ethernet.begin(mac, ip); //FOR STATIC IPv4
  server.begin();
  Serial.println(F("Webapp created by: Martin Chlebovec"));
  Serial.println(F("Build 1.0.4 from 18. Sep 2021"));
  Serial.println(F("Ethernet thermostat IP address:"));
  Serial.println(Ethernet.localIP());
  wdt_enable(WDTO_8S);
}

void loop() {
  wdt_reset();
  if ((millis() - cas) >= 10000 || cas == 0) {
    cas = millis();
    Serial.println(F("Ethernet thermostat IP address:"));
    Serial.println(Ethernet.localIP());
    teplota = sensorsA.getTempCByIndex(0);
    String referencia = read_String(10);
    String hystereza = read_String(100);
    float referencia_teplota = referencia.toFloat();
    float hystereza_teplota = hystereza.toFloat();
    float minus_hystereza_teplota = (-1 * hystereza_teplota);
    float rozdiel = referencia_teplota - teplota;
    if (rozdiel > hystereza_teplota) {
      Serial.println(F("Output on"));
      stav = "ON";
      digitalWrite(rele, LOW);
    } else if (rozdiel &lt; minus_hystereza_teplota) {
      Serial.println(F("Output off"));
      stav = "OFF";
      digitalWrite(rele, HIGH);
    } else {
      Serial.println(F("Difference between target and actual temp is not above or below the hysteresis. The output state does not change."));
      Serial.print(F("Actual state of output: "));
      Serial.println(stav);
    }
    sensorsA.requestTemperatures();
  }
  EthernetClient client = server.available();
  if (client) {
    while (client.connected()) {
      if (client.available()) {
        String line = client.readStringUntil('\n');
        char str[line.length() + 1];
        line.toCharArray(str, line.length());
        char *method;
        char *request;
        method = strtok(str, terminator1);
        request = strtok(NULL, terminator1);
        if (String(request) == "/") {
          int days = millis() / day ;                                //number of days
          unsigned int hours = (millis() % day) / hour;                       //the remainder from days division (in milliseconds) divided by hours, this gives the full hours
          unsigned int minutes = ((millis() % day) % hour) / minute ;         //and so on...
          unsigned int seconds = (((millis() % day) % hour) % minute) / second;
          //HLAVNA ROOT HTTP STRANKA
          client.println(F("HTTP/1.1 200 OK"));
          client.println(F("Content-Type: text/html"));
          client.println();
          client.println(F("&lt;!DOCTYPE html>"));
          client.println(F("&lt;html>"));
          client.println(F("&lt;head>"));
          client.println(F("&lt;script type='text/javascript'>"));
          client.println(F("window.smartlook||(function(d) {"));
          client.println(F("var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];"));
          client.println(F("var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';"));
          client.println(F("c.charset='utf-8';c.src='https://rec.smartlook.com/recorder.js';h.appendChild(c);"));
          client.println(F("})(document);"));
          client.println(F("smartlook('init', '6beae97f98b9844b761672af23f38fc60b962338');"));
          client.println(F("&lt;/script>"));
          client.println(F("&lt;meta charset='utf-8'>"));
          client.println(F("&lt;meta name='author' content='Martin Chlebovec'>"));
          client.println(F("&lt;meta http-equiv='Refresh' content='30'; />"));
          client.println(F("&lt;meta name='viewport' content='width=device-width, initial-scale=1'>"));
          client.println(F("&lt;link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css'>"));
          client.println(F("&lt;script type='text/javascript'>"));
          client.println(F("var timeleft = 30;"));
          client.println(F("var downloadTimer = setInterval(function(){"));
          client.println(F("if(timeleft &lt;= 0){"));
          client.println(F("clearInterval(downloadTimer);"));
          client.println(F("document.getElementById(\"countdown\").innerHTML = \"Refresh...\";"));
          client.println(F("} else {"));
          client.println(F("document.getElementById(\"countdown\").innerHTML = timeleft + \" seconds to refresh\";"));
          client.println(F("}"));
          client.println(F("timeleft -= 1;"));
          client.println(F("}, 1000);"));
          client.println(F("&lt;/script>"));
          client.println(F("&lt;title>HTTP webserver - Arduino + Ethernet&lt;/title>"));
          client.println(F("&lt;/head>"));
          client.println(F("&lt;body>"));
          client.println(F("&lt;center>&lt;h3>Enter data for webserver (will be stored in EEPROM):&lt;/h3>"));
          client.println(F("&lt;form action='/action.html' method='get'>"));
          client.println("&lt;b>Target temperature:&lt;/b>&lt;br>&lt;input type='text' id='fname' name='fname' value=" + read_String(10) + ">&lt;br>");
          client.println("&lt;b>Hysteresis:&lt;/b>&lt;br>&lt;input type='text' id='fname2' name='fname2' value=" + read_String(100) + ">&lt;br>");
          client.println(F("&lt;input type='submit' class='btn btn-success' value='Send'>"));
          client.println(F("&lt;/form>&lt;hr>"));
          if (stav == "ON") {
            client.println(F("&lt;b>&lt;font color='green'>Output: ON&lt;/font>&lt;/b>"));
          }
          if (stav == "OFF") {
            client.println(F("&lt;b>&lt;font color='red'>Output: OFF&lt;/font>&lt;/b>"));
          }
          client.println(F("&lt;div id=\"countdown\">&lt;/div>"));
          client.print(F("&lt;b>Actual temperature from DS18B20:&lt;/b> "));
          client.print(teplota);
          client.println(F(" °C"));
          client.print(F("&lt;hr>"));
          client.print(F("&lt;b>Uptime: &lt;/b>"));
          client.print(days);
          client.print(F("d"));
          client.print(F(" "));
          client.print(hours);
          client.print(F("h"));
          client.print(F(" "));
          client.print(minutes);
          client.print(F("m"));
          client.print(F(" "));
          client.print(seconds);
          client.print(F("s"));
          client.println(F("&lt;h3>Author: Martin Chlebovec - martinius96@gmail.com - https://martinius96.github.io/termostat-ethernet/en/&lt;/h3>"));
          client.println(F("&lt;h4>Free version - 1.0.4 build: 18. Sep. 2021&lt;/h4>"));
          client.println(F("&lt;/center>"));
          client.println(F("&lt;/body>"));
          client.println(F("&lt;/html>"));
          delay(1);
          client.stop();
          client.flush();
        } else if (String(request) == "/get_data.json") {
          //PODSTRANKA PRE VYCITANIE DAT (INYM MIKROKONTROLEROM)
          client.println(F("HTTP/1.1 200 OK"));
          client.println(F("Content-Type: application/json"));
          client.println();
          client.println(F("{"));
          client.print(F("\"Hysteresis\":"));
          client.print(read_String(100));
          client.println(F(","));
          client.print(F("\"Target_Temperature\":"));
          client.print(read_String(10));
          client.println(F(","));
          client.print(F("\"Actual_Temperature\":"));
          client.println(String(teplota));
          client.println(F("}"));
          delay(1);
          client.stop();
          client.flush();
        } else if (String(request) == "/favicon.ico") { //fix chybajuceho faviconu
          client.stop();
        } else {
          String myString = String(request);
          if (myString.startsWith("/action.html")) {
            char* parameter;
            char* value;
            char* hodnota1;
            char* hodnota2;
            parameter = strtok(request, terminator3);
            Serial.println(parameter);
            value = strtok(NULL, terminator3);
            hodnota1 = strtok(value, terminator4);
            hodnota2 = strtok(NULL, terminator4);
            char* H_1;
            char* H_2;
            strtok(hodnota1, terminator5);
            H_1 = strtok(NULL, terminator5);
            strtok(hodnota2, terminator5);
            H_2 = strtok(NULL, terminator5);
            String first_param = String(H_1);
            String second_param = String(H_2);
            if (isFloat(first_param)) {
              writeString(10, String(H_1));
            } else {
              Serial.println(F("User input for key fname (Target temperature) is not a number!"));
            }
            if (isFloat(second_param)) {
              writeString(100, String(H_2));
            } else {
              Serial.println(F("User input for key fname2 (Hysteresis) is not a number!"));
            }
            client.println(F("HTTP/1.1 200 OK"));
            client.println(F("Content-Type: text/html"));
            client.println();
            client.println(F("&lt;!DOCTYPE html>"));
            client.println(F("&lt;html>"));
            client.println(F("&lt;head>"));
            client.println(F("&lt;meta charset='utf-8'>"));
            client.println(F("&lt;meta http-equiv='Refresh' content='5; url=/' />"));
            client.println(F("&lt;title>HTTP webserver - Arduino + Ethernet&lt;/title>"));
            client.println(F("&lt;/head>"));
            client.println(F("&lt;body>"));
            client.println(F("&lt;center>&lt;h3>Server received datas from HTML form:&lt;/h3>"));
            if (!isFloat(second_param) || !isFloat(second_param)) {
              client.println(F("&lt;h3>&lt;font color='red'>The data entered is not a number!!! Please try again after redirecting.&lt;/font>&lt;/h3>"));
            } else {
              client.println("&lt;li>&lt;b>Target temperature: &lt;/b>" + String(H_1) + "&lt;/li>");
              client.println("&lt;li>&lt;b>Hysteresis: &lt;/b>" + String(H_2) + "&lt;/li>");
            }
            client.println(F("&lt;b>Redirecting ... Please wait&lt;/b>&lt;/center>"));
            client.println(F("&lt;/body>"));
            client.println(F("&lt;/html>"));
            delay(1);
            client.stop();
            client.flush();
          } else {
            client.println(F("HTTP/1.1 404 Not Found"));
            client.println();
            delay(1);
            client.stop();
            client.flush();
          }
        }
      }
    }
  }
}
</pre>
<p style="text-align: justify;">
The implementation contains programs for the static / dynamic IPv4 address assigned to the Ethernet shield.
<b> The thermostat is only intended for indoor temperatures! </b> (above 0 ° C), to which the system logic is adapted!
The thermostat can replace the existing room thermostat, it is possible to temporarily replace the heater in the aquarium / terrarium to maintain a constant temperature.
</p>
<div class="alert alert-danger">
	<b> Ethernet thermostat version 1.0.3 changelog: </b>
<li> Web application optimization, increased response speed for low-latency response </li>
<li> For HTML form, input number numbers had to be removed due to incompatibility with Google Chrome for Android. </li>
<li> Modified backend, to compare input data type with (non) acceptance of input. </li>
<li> Fixed JSON output (reversed control temperatures) to opposite entities </li>
<li> Fixed Content-type for JSON output from text / html to application / json </li>
<li> All static parts of HTML pages moved to ROM via the F() macro </li>
<li> Maximum lightweight RAM for trouble-free running of a low-latency web server. </li>
<li> For the DHCP example, the Ethernet.maintain() function is used to renew the DHCP pool time. </li>
<li> (renew the same IP address / request a new one - depending on your DHCP service configuration) </li>
<li> Rename a JSON file from get_data to get_data.json </li>
<li> Device uptime displayed - days, hours, minutes, seconds </li>
<li> HTTP 404 - Not Found when viewing a location to which the web server has no callback </li>
</div>	
 </div>
		</div>
</div>
</body>
        <script>
$(document).ready(function(){
  $('[data-toggle="tooltip2"]').tooltip();   
});
</script>
</html>
