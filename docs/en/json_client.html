<!DOCTYPE html>
<html lang="en">
<head>
  	<meta property="og:title" content="JSON client - Ethernet room thermostat - MQTT Publish, ArduinoJson, deserialization, data parsing" />
	<meta name="robots" content="index, follow">
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="sitemap" type="application/xml" title="Sitemap" href="../../sitemap.xml" />
    	<meta name='revisit-after' content='2 days'>
    	<title>JSON client - Ethernet thermostat - MQTT Publish, ArduinoJson, deserialization, data parsing</title>
    	<meta property='fb:admins' content='100001242570317'>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
    	<meta name="description" content="JSON client on Arduino platform, ESP866, ESP32 for Ethernet thermostat project. They enable data parsing, Publish to MQTT service IoT Industries Slovakia">
    	<meta name="keywords" content="json, arduino, ethernet, wifi, esp8266, esp32, parsing, arduinojson, deserialization, mqtt, publish, subscribe, data, transmission, http, mqtts, encrypted, socket, iot, industries, slovakia, thermostat, thermostat">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<meta name="google-site-verification" content="UwZZh2EXv3iWUAi_1Z0hLxVCz6ySJ4UdY_BPoLtejwo" />
	<script type="text/javascript">
    		window.smartlook||(function(d) {
    			var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];
    			var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';
    			c.charset='utf-8';c.src='https://rec.smartlook.com/recorder.js';h.appendChild(c);
    		})(document);
    		smartlook('init', 'db50efe9fff280a17db52b82be221240cbbd3dbe');
	</script>    
			<style>
	#right {
  position: absolute;
  right: 0px;
}
	</style>
</head>
<body>
	<div class="container">
  		<div class="row">
<div class="col-sm-12">
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Thermostat - Ethernet</a>
    </div>
    <ul class="nav navbar-nav">
      	<li><a href="index.html">Overview</a></li>
	<li><a href="zapojenie.html">Involvement</a></li>      
	<li class=""><a href="spustenie.html">Firmware</a></li>
  <li class="active"><a href="json_client.html">JSON client</a></li>
      	<li><a href="kontakt.html">Contact</a></li>
<li><a href="phy_ethernet.html">ESP32 + PHY</a></li>
<a href="../de/json_client.html"><img src="https://futbalovysen.sk/wp-content/uploads/germany.png" alt="Germany.png, 2,2kB" title="Germany" height="32" width="32"></a>	
<a href="../json_client.html"><img src="https://futbalovysen.sk/wp-content/uploads/slovakia.png" alt="Slovak flag.png, 2,2kB" title="Slovakia" height="32" width="32"></a>     
<li style="float: right; "><a href="https://martinius96.github.io/WiFi-termostat/en/" class="btn btn-success" role="button" title="Zmeniť projekt na WiFi termostat"><img src="https://www.flaticon.com/premium-icon/icons/svg/3686/3686730.svg" width=16px height=16px> <font color="white">WiFi thermostat</font></a></li></ul>
  </div>
</nav>   			
<div class="alert alert-success">
	<strong>Project repository with source code for JSON clients - Github: </strong><a href="https://github.com/martinius96/termostat-ethernet/">Thermostat - Ethernet</a>
</div>	
<span class="label label-default">Arduino</span>
<span class="label label-primary">Ethernet</span>
<span class="label label-success">Wiznet W5100 / W5500</span>
<span class="label label-info">DS18B20</span>
<span class="label label-warning">OneWire</span>
<span class="label label-danger">Dallas</span>
<span class="label label-default">HTML</span>
<span class="label label-primary">Webserver</span>
<span class="label label-success">WebSocket</span>
<div class="row">
  <div class="col-sm-3"><center><img src="https://i.imgur.com/X946pmi.png" width="128px" height="128px" style="border-radius: 50%;" alt="JSON DATA" title="JSON DATA"><br><b>JSON DATA</b></center></div>
  <div class="col-sm-3"><center><img src="https://i.imgur.com/B2xdel0.png" width="128px" height="128px" alt="ArduinoJSON" title="ArduinoJSON"><br><b>ArduinoJSON</b></center></div>
  <div class="col-sm-3"><center><img src="https://i.imgur.com/oXhOEZi.png" width="128px" height="128px" style="border-radius: 50%;" alt="MQTT" title="MQTT"><br><b>MQTT</b></center></div>
  <div class="col-sm-3"><center><img src="https://i.imgur.com/WWpufkP.png" width="128px" height="128px" style="border-radius: 50%;" alt="HTTP" title="HTTP"><br><b>HTTP</b></center></div>
</div>	
<hr><center><h2>JSON clients - Ethernet thermostat</h2></center><hr>
<p style="text-align: justify;">
JSON client built on Arduino platform, ESP8266, ESP32 allows connection via websocket to Ethernet thermostat.
<b> The client performs a cyclic HTTP GET request every 15 seconds to retrieve the content of the <a href="../get_data.json">/get_data.json</a> subpage, where the web server distributes target temperature, hysteresis, and currently measured temperature data to the DS18B20 sensor on the OneWire bus in JSON format. </b>
The loaded JSON payload can parse the JSON client from the HTTP response and then deserialize this string.
After deserialization, it is possible to access the individual keys to which the values are assigned and obtain them -> parse.
The matched data is written to the UART - Serial line - 115200 baud / s.
In a user application that can be added to existing JSON client source codes, entities can be controlled based on these values, for example: radiator valve opening, solenoid, ventilation, window closing, etc.
Alternatively, it is possible to archive data - send it to a web server, where it can be stored, for example, in a MySQL database, in Loxone home automation.
<b> Part of the firmware marked as MQTT or MQTTS (encrypted MQTT) is an extended JSON client with the ability to send - Publish to MQTT Broker IoT Industries Slovakia - Slovak free MQTT Broker designed for developers. </b>
Both the MQTT and MQTTS variants use a socket, which is also used for HTTP requests to obtain JSON payloads.
The existing MQTT server can be replaced in your source code by yours, so you can also make the data from the thermostat available to home automation systems (Hassio, Mosquitto MQTT, Domoticz, Loxone and others ...).
In the current software implementation, the microcontroller (JSON client) sends the acquired data to the MQTT Broker in the thermostat topic, while the individual temperatures are differentiated in subtopics.
</p> 
<div class="alert alert-success">
	<strong>Example source codes for JSON Clients are available: </strong><a href="https://github.com/martinius96/termostat-ethernet/tree/master/examples">HERE</a>
</div>
<hr><center><h4>Available libraries for microcontrollers (Arduino / ESP) - JSON clients</h4></center><hr>
<div class="alert alert-danger">
	Library archive (.zip) extract to <strong>C:/Users/[User]/Documents/Arduino/libraries</strong>
</div>
<div class="table-responsive">   
<table class="table" style="border: 1px solid black;">
<thead>
<tr>
<th style="width: 25%">Library name</th>
<th style="width: 50%">Library function</th>
<th style="width: 25%">Download</th>
</tr>
</thead>
<tbody>
<tr>
<td style="width: 25%"><b>PubSubClient</b></td>
<td style="width: 50%">
<p style="text-align: justify;">
Library for AVR microcontrollers (ATmega) Arduino Uno / Nano / Mega, ESP8266 and ESP32.
It enables communication via the MQTT protocol, it is also possible to implement an encrypted connection with the MQTT Broker, the use of WiFiClientSecure is required for ESP microcontrollers. 
</p>
</td>
<td style="width: 25%"><a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/martinius96/hladinomer-studna-scripty/tree/master/src/PubSubClient" class="btn btn-success" role="button">Download</a></td>
</tr>
<tr>
<td style="width: 25%"><b>ArduinoJson</b></td>
<td style="width: 50%">
<p style="text-align: justify;">
Library for AVR microcontrollers (ATmega) Arduino Uno / Nano / Mega, ESP8266 and ESP32.
It allows you to deserialize a string in a JSON structure, it can parse the value that is assigned to a key.
</p>
</td>
<td style="width: 25%"><a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/martinius96/hladinomer-studna-scripty/tree/master/src/ArduinoJson" class="btn btn-success" role="button">Download</a></td>
</tr>
</tbody>
</table>
	</div>
<hr>
<h4><font color="#C0392B">Sample data listing in JSON format - Ethernet thermostat</font></h4>
<hr>
<div class="alert alert-danger">
	{<br>
		"Hysteresis":0.25,<br>
		"Target_Temperature":21.75,<br>
		"Actual_Temperature":21.43<br>
	}
</div>
<div class="alert alert-info">
  <strong> The implementation for MQTTS is only available for ESP8266, ESP32 platforms. </strong> ESP8266 uses a fingerprint for the encrypted connection - the fingerprint of the MQTT server certificate (public key).
ESP32 uses a Root CA certificate for encrypted connection to the MQTT server. <b> The encrypted port of the MQTT server is 8883 by default, unencrypted 1883. </b>
To obtain a fingerprint, ie a Root CA certificate for a specific MQTT server (domain), it is possible to use the OpenSSL tool, which allows easy retrieval and display of the information in question.
<br> <b> Command to get MQTT server fingerprint: </b> <br>
<code>openssl s_client -connect mqttserver.com:8883 -showcerts < /dev/null 2>/dev/null | openssl x509 -in /dev/stdin -sha1 -noout -fingerprint</code>
<br> <b> Command to obtain the Root CA certificate that issued the certificate for the MQTT server (Issuer): </b> <br>
<code>openssl s_client -showcerts -verify 5 -connect mqttserver.com:8883 < /dev/null</code>
</div>
<hr><h4> The topics used for Publish to MQTT Broker are: </h4><hr>
<li><b>termostat/hysteresis</b> - for hysteresis</li>
<li><b>termostat/actual_temp</b> - for the currently measured temperature</li>
<li><b>termostat/target_temp</b> - for the target (reference) temperature</li>
<hr><h4>Topic for Subscribe:</h4><hr>
<li><b>termostat/#</b> - takes all subtopics under the termostat/, ie hysteresis, current and target temperature</li>
<p style="text-align: justify;">
<b>The MQTT client has a subscribed subscription to the main topic thermostat and all its subtopics. It can also verify whether the information has been successfully published on MQTT Broker.</b>
<b><font color="red">WARNING: MQTT Broker IoT Industries Slovakia, which is used in the sample implementation, is public and so the data can be changed, overwritten, read by any user! </font> </b>
If any other user uploads the JSON client firmware to their microcontroller without change, the data in the predefined topic will be overwritten by you, as well as by him. It is therefore advisable to choose another topic where the data will be sent during the actual implementation.
</p>    
<hr><h4>Block diagram - description of JSON client functionality:</h4><hr>
<center>
<img src="https://i.imgur.com/m2O62dn.jpg" style="display: block; max-width: 100%; height: auto;" title="JSON klient - Arduino, ESP8266, ESP32, MQTT integrácia - Ethernet termostat" alt="JSON klient - Arduino, ESP8266, ESP32, MQTT integrácia - Ethernet termostat">
</center>
<hr><h4>JSON client - UART output (Serial line):</h4><hr>
<center><img src="https://i.imgur.com/4Cm5z8o.png" style="display: block; max-width: 100%; height: auto;" alt="JSON client pre WiFi termostat - UART výstup" title="JSON client pre WiFi termostat - UART výstup"></center>       		
<h4>HiveMQ client - Subscribe topic termostat/#</h4>
<center><img src="https://i.imgur.com/UEnHDb2.png" style="display: block; max-width: 100%; height: auto;" alt="JSON client MQTT Broker IoT Industries Slovakia - výstup topicu - Subscribe termostat" title="JSON client MQTT Broker IoT Industries Slovakia - výstup topicu - Subscribe termostat"></center> 
	</div>
	</div>
					</div>
</body>
</html>
