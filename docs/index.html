<!DOCTYPE html>
<html lang="sk-SK">
<head>
	<!-- Primary Meta Tags -->
<title>Ethernet Termostat - Arduino + Wiznet W5100/W5500</title>
    <meta name="description" content="Zoznámte sa s Ethernet termostatom, ktorý využíva Arduino a Wiznet moduly na automatické riadenie teploty. Zistite, ako funguje, a ako ho môžete prispôsobiť vašim potrebám.">
    <meta name="keywords" content="Ethernet termostat, Arduino, Wiznet, teplota, DS18B20, webserver, OneWire, projekt, IoT">
	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://martinius96.github.io/termostat-ethernet/">
	<meta property="og:title" content="Izbový termostat pre riadenia kotla s webaplikáciou - Webserver - Arduino + Ethernet Wiznet W5100 / W5500">
	<meta property="og:description" content="Izbový termostat navrhnutý na platforme Arduino Uno + Ethernet shield Wiznet W5100 / W5500. Termostat pre vykurovanie / chladenie.">

	<!-- Twitter -->
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:url" content="https://martinius96.github.io/termostat-ethernet/">
	<meta property="twitter:title" content="Izbový termostat pre riadenia kotla s webaplikáciou - Webserver - Arduino + Ethernet Wiznet W5100 / W5500">
	<meta property="twitter:description" content="Izbový termostat navrhnutý na platforme Arduino Uno + Ethernet shield Wiznet W5100 / W5500. Termostat pre vykurovanie / chladenie.">
	
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="sitemap" type="application/xml" title="Sitemap" href="../sitemap.xml" />
	<meta name="google-site-verification" content="UwZZh2EXv3iWUAi_1Z0hLxVCz6ySJ4UdY_BPoLtejwo" />    	
	<meta property='fb:admins' content='100001242570317'>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script type="text/javascript">
    		window.smartlook||(function(d) {
    			var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];
    			var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';
    			c.charset='utf-8';c.src='https://rec.smartlook.com/recorder.js';h.appendChild(c);
    		})(document);
    		smartlook('init', 'db50efe9fff280a17db52b82be221240cbbd3dbe');
	</script>    
			<style>
	#right {
  position: absolute;
  right: 0px;
}
	</style>
</head>
<body>
	<div class="container">
  		<div class="row">
    			<div class="col-sm-12">
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Termostat - Ethernet</a>
    </div>
    <ul class="nav navbar-nav">
      	<li class="active"><a href="index.html">Prehľad</a></li>
	<li><a href="zapojenie.html">Zapojenie</a></li>      
	<li class=""><a href="spustenie.html">Firmvér</a></li>
  <li><a href="json_client.html">JSON client</a></li>
      	<li><a href="kontakt.html">Kontakt</a></li>
<li><a href="phy_ethernet.html">ESP32 + PHY</a></li>
<a href="de/index.html"><img src="https://futbalovysen.sk/wp-content/uploads/germany.png" alt="Germany.png, 2,2kB" title="Germany" height="32" width="32"></a>	
<a href="en/index.html"><img src="https://i2.wp.com/facsusa.com/wp-content/uploads/2017/05/Flag-of-England.png?ssl=1" alt="English.png, 2,2kB" title="English" height="32" width="32"></a>
	 <li style="float: right; "><a href="https://martinius96.github.io/WiFi-termostat/" class="btn btn-success" role="button" title="Zmeniť projekt na WiFi termostat"><img src="https://www.flaticon.com/premium-icon/icons/svg/3686/3686730.svg" width=16px height=16px> <font color="white">WiFi termostat</font></a></li>
</ul>
  </div>
</nav>  
<div class="alert alert-success">
	<strong>Repozitár projektu Ethernet termostat - strojové kódy: </strong><a href="https://github.com/martinius96/termostat-ethernet/tree/master/firmware">Github</a>
</div>						
<div class="alert alert-info">
	<strong>Článok k projektu na Chiptron.cz: </strong><a href="https://chiptron.cz/articles.php?article_id=273">Izbový termostat - Arduino + Ethernet</a>
</div>	
<div class="alert alert-success">
	<strong>Firmvér pre Ethernet termostat je plné dostupný v slovenskej jazykovej mutácii.</strong>
</div>	
<div class="alert alert-danger">
 	<strong>Podporte projekt Ethernet termostat cez PayPal. Podpora umožní pridať nové funkcionality v budúcnosti a otvorenie zdrojového kódu aplikácie: </strong><a href="https://www.paypal.com/paypalme/chlebovec" class="btn btn-primary" role="button">PayPal donate</a>
</div>	
<span class="label label-default">Arduino</span>
<span class="label label-primary">Ethernet</span>
<span class="label label-success">Wiznet W5100 / W5500</span>
<span class="label label-info">DS18B20</span>
<span class="label label-warning">OneWire</span>
<span class="label label-danger">Dallas</span>
<span class="label label-default">HTML</span>
<span class="label label-primary">Webserver</span>
<span class="label label-success">WebSocket</span>
<hr><h4>Kompatibilný riadiaci hardvér pre Ethernet termostat:</h4><hr>
<div class="row">
<div class="col-sm-3"><center><img src="https://i.imgur.com/wtnzKqO.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler Arduino UNO" title="Riadiaci mikrokontróler Arduino UNO"><br><b>Arduino UNO</b><br><a href="https://techfun.sk/produkt/arduino-uno-r3-precizny-klon/" class="btn btn-primary" role="button">Kúpiť Techfun.sk</a></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/XHC8DBe.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler Arduino Nano" title="Riadiaci mikrokontróler Arduino Nano"><br><b>Arduino Nano</b><br><a href="https://techfun.sk/produkt/arduino-nano-precizny-klon/" class="btn btn-primary" role="button">Kúpiť Techfun.sk</a></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/4xX0BoE.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler ATmega328P DIP" title="Riadiaci mikrokontróler ATmega328P DIP"><br><b>ATmega328P - DIP28</b><br><a href="https://techfun.sk/produkt/atmega328p-pu/" class="btn btn-primary" role="button">Kúpiť Techfun.sk</a></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/FANTMuW.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler ATmega328P SMD" title="Riadiaci mikrokontróler ATmega328P SMD"><br><b>ATmega328P - SMD</b><br><a href="https://techfun.sk/produkt/atmega328p-au-samostatny-cip/" class="btn btn-primary" role="button">Kúpiť Techfun.sk</a></center></div>
</div>	
<hr><h4>Kompatibilné Ethernet moduly a shieldy pre Ethernet termostat:</h4><hr>
<div class="row">
<div class="col-sm-4"><center><img src="https://i.imgur.com/aaS35X2.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet shield Wiznet W5100" title="Ethernet shield Wiznet W5100"><br><b>Ethernet shield Wiznet W5100</b><br><a href="https://techfun.sk/produkt/ethernet-shield-w5100/" class="btn btn-primary" role="button">Kúpiť Techfun.sk</a></center></div>
<div class="col-sm-4"><center><img src="https://i.imgur.com/mz4dhRA.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet modul Wiznet W5500" title="Ethernet modul Wiznet W5500"><br><b>Ethernet modul Wiznet W5500</b><br><a href="https://techfun.sk/produkt/ethernet-modul-w5500/" class="btn btn-primary" role="button">Kúpiť Techfun.sk</a></center></div>
<div class="col-sm-4"><center><img src="https://i.imgur.com/LhpZGxj.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet modul Wiznet USR-ES1" title="Ethernet modul Wiznet USR-ES1"><br><b>Ethernet modul Wiznet USR-ES1 (W5500 V2)</b><br><a href="https://techfun.sk/produkt/ethernet-mini-modul-w5500-lite/" class="btn btn-primary" role="button">Kúpiť Techfun.sk</a></center></div>
</div>				
<hr><center><h1>Izbový termostat - Arduino + Ethernet</h1></center><hr>
<p style="text-align: justify;">
Arduino je vynikajúca embedded platforma, ideálna pre vytvorenie izbového termostatu s Ethernet konektivitou a webserverom implementovaným priamo na Arduine. Implementácia využíva populárne modely ako Arduino Uno / Nano s čipom AVR ATmega328P a Ethernet shieldom Wiznet W5100 / W5500, pričom komunikácia prebieha cez SPI zberniciu alebo ICSP header.
Termostat funguje ako webserver, schopný prijímať a spracovávať požiadavky od klientov v sieti prostredníctvom HTTP protokolu. Následne odpovedá HTML / JSON kódom a vykonáva príslušné funkcie backendu, vrátane spustenia skriptov, ovládania GPIO, zápisu do pamäte a ďalších funkcií.
Termostat je prístupný z lokálnej siete (LAN), pričom disponuje webovým rozhraním, ktoré umožňuje konfiguráciu všetkých parametrov termostatu, ako sú cieľová teplota a hysteréza. Webserver podporuje viacero nezávislých HTML stránok, ktoré môžu mať informatívny obsah alebo implementovaný funkčný backend s rôznymi funkciami termostatu.
Systém beží na štandardnom HTTP porte - 80, čím je zabezpečená kompatibilita so všetkými zariadeniami a jednoduchý prístup prostredníctvom webového prehliadača. Vytvorte si vlastný inteligentný termostat pomocou tejto výkonnej Arduino platformy s Ethernet konektivitou.
</p>
<hr>
<p style="text-align: justify;">
Termostat je schopný automaticky ovládať signalizačné relé pre zapnutie a vypnutie kotla prostredníctvom GPIO výstupu. Týmto spôsobom môže nahradit existujúci izbový termostat a umožniť prístup klientom cez sieť. Podporuje širokú škálu zariadení s webovým prehliadačom, vrátane počítačov, smartfónov, tabletov, Smart TV a podobne.
Rozhodovací algoritmus termostatu využíva cieľovú teplotu s hysterézou, ktorá sa porovnáva s aktuálnou teplotou z digitálneho senzora teploty Dallas DS18B20. Cieľová teplota a hysteréza sú ukladané v EEPROM pamäti, aby boli trvale dostupné aj pri výpadku napájania.
Senzor DS18B20 dosahuje rozlíšenie 12 bitov, čo znamená minimálny rozlišovací krok 0,0625 °C medzi jednotlivými meraniami. Dáta získané cez OneWire zbernicu môžu byť vyžiadané do mikrokontroléru v intervaloch od 500 do 1000 ms, v závislosti od počtu pripojených senzorov a dĺžky zbernice.
Rozhodovacia logika termostatu sa vykonáva každých 10 sekúnd nezávisle na webovej aplikácii, čo znamená, že nie je potrebné udržiavať keep-alive spojenie pre vykonanie logiky. Systém tak funguje autonómne a nevyžaduje aktívnu pozornosť používateľa. Vytvorte si inteligentný a efektívny systém vykurovania s týmto pokročilým termostatom.
</p>
<b>Z hardvérovej perspektívy využíva projekt nasledujúce komponenty:</b>
<ul>
  <li>Arduino Uno</li>
  <li>Ethernet shield Wiznet W5100 / Ethernet modul Wiznet W5200-W5500</li>
  <li>Teplotný senzor DS18B20 na OneWire zbernici v puzdre TO-92 alebo vo vodotesnom vyhotovení v hliníkovej rúrke</li>
  <li>Elektromagnetické relé SRD-5VDC-SL-C / SSR relé OMRON G3MB-202P, slúžiace na spínanie kotla (signál Active-LOW)</li>
</ul>
<p style="text-align: justify;">
<b>HTML stránky bežiace na Arduine:</b>
<li><b>/</b> - root stránka obsahujúca formulár, aktuálny výpis logického výstupu pre relé, teplotu</li>
<li><b>/action.html</b> - spracúvava hodnoty z formulára, zapisuje ich do EEPROM pamäte, presmeruje používateľa späť na root stránku</li>
<li><b>/get_data.json</b> - distribuuje dáta o aktuálnej teplote, referenčnej teplote a hysteréza tretej strane (počítač, mikrokontróler, iný klient...) v JSON formáte</li>
<hr>				
Elektromagnetické relé SRD-5VDC-SL-C, použité v projekte, umožňuje spínať až 10A pri 230V, čo zodpovedá maximálnemu výkonu 2300W. Pri spínaní jednosmerného obvodu je možné dosiahnuť 300W (10A pri 30V DC max). Schéma zapojenia je plne kompatibilná aj s SSR relé OMRON G3MB-202P, ktoré je vhodné pre neinduktívnu záťaž a výhradne pre striedavé napätie (DC obvod nedokáže po zopnutí rozopnúť). Maximálny spínaný výkon pre OMRON G3MB-202P je 460W (230V, 2A).
<b>Termostat je vhodný na používanie počas celého roka. V prípade nevyžadovaného riadenia je možné fyzicky odpojiť výstup a termostat využívať ako Ethernet teplomer pre získanie dát z miestnosti, kde sa nachádza.</b> Táto flexibilita umožňuje rozsiahle využitie termostatu podľa potrieb a okolností prostredia, v ktorom je inštalovaný.
</p>
<img src="https://i.imgur.com/pwZqOfS.jpg" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - Arduino + Wiznet W5100/W5500 - webserver" title="Ethernet thermostat - Arduino + Wiznet W5100/W5500 - webserver"> 
<b>Webové rozhranie pre Ethernet termostat umožňuje:</b>
<li>Prehliadať v reálnom čase teplotu zo senzora DS18B20 na OneWire zbernici, uptime zariadenia, stav výstupu s dynamickou zmenou, aktuálne nastavené konfiguračné údaje pre termostat t.j. cieľovú teplotu a hysterézu z EEPROM</li>
<li>Modifikovať cieľovú (referenčnú) teplotu <del>v rozsahu 5 až 50 °C s 0,25 °C krokom</del><img src="https://i.imgur.com/zMsp0cr.png" width="20px" height="20px" data-toggle="tooltip2" data-placement="right" title="Rozsah odobratý vo verzii 1.0.2 z dôvodu nepodpory desatinnej čiarky pre input type number na OS Android"></li>
<li>Modifikovať hysterézu <del>v rozsahu 0 až 10 °C s 0,25 °C krokom</del><img src="https://i.imgur.com/zMsp0cr.png" width="20px" height="20px" data-toggle="tooltip2" data-placement="right" title="Rozsah odobratý vo verzii 1.0.2 z dôvodu nepodpory desatinnej čiarky pre input type number na OS Android"></li>

<b>ZAP/VYP regulácia kotla:</b> 
<li>Príklad ZAP/VYP regulácie vykurovania - <font color="red">VIZUALIZÁCIA NIE JE SÚČASŤOU PROJEKTU</font></li>	
<li>Kotol je aktívny po dobu dostiahnutia cieľovej teploty + hysterézy</li>
<li>Na vizualizácii teplôt vody je patrný tzv. dobeh vykurovania a následné chladnutie vody až do opätovnej aktivity vykurovania, kedy je nameraná teplota pod nastavenú cieľovú teplotu - hystérzu</li>		
<img src="https://i.imgur.com/IDWLuOr.png" style="display: block; max-width: 100%; height: auto;" alt="ZAP/VYP regulácia kotla s hysterézou" title="ZAP/VYP regulácia kotla s hysterézou">        			    
<p style="text-align: justify;">
Webové rozhranie je navrhnuté s ohľadom na prispôsobenie sa obrazovkám rôznych veľkostí, či už ide o väčšie alebo menšie displeje. Je plne reaktívne a podporuje širokouhlé obrazovky s vysokým rozlíšením, ako aj mobilné zariadenia. Rozhranie využíva importované CSS štýly z Bootstrap frameworku, ktoré sú hostované na externom CDN serveri. Tieto štýly sa načítavajú na strane klienta pri otvorení stránky bežiacej na Arduine.
Vzhľadom na obmedzenú pamäť Arduino Uno, ktoré má k dispozícii len niekoľko kilobytov, umožňuje importovanie CSS štýlov z externého servera znížiť zaťaženie pamäte a výkonu. Programová implementácia (pre Arduino Uno) využíva približne 70% flash pamäte (32 kB - 4 kB Bootloader) a 44% RAM pamäte (2 kB).
Statické časti webovej stránky, ako sú hlavička a päta HTML dokumentu, odkazy na Bootstrap CSS, meta tagy, HTTP response hlavička, Content Type, formuláre a ďalšie, sú uložené priamo vo flash pamäti Arduina. Toto riešenie výrazne znižuje veľkosť používanej RAM pamäte pre obsah generovaný používateľovi. Webserver je tak stabilnejší a schopný spracovať viacero súčasných pripojení zariadení v sieti.
Celková spotreba celého termostatu je udržaná na úrovni do 200 mA pri 5V napájaní, čo zodpovedá menej než 1W. Táto efektívnosť prispieva k nízkej energetickej náročnosti termostatu.
</p>
<hr>
<p style="text-align: justify;">
Uloženie nastavených hodnôt do EEPROM pamäte Arduino (k dispozícii 512 B) zabezpečuje zachovanie týchto hodnôt aj po výpadku napájania. Referenčná teplota je zapisovaná na offset 10, hysteréza na offset 100. Každá z hodnôt zaberá maximálne 5 B v EEPROM pamäti, vrátane ukončovacieho znaku - terminátora. Limit prepisovania EEPROM je nastavený na úroveň 100-tisíc prepisov. Dáta sa prepisujú iba pri odoslaní HTML formulára, čo minimalizuje záťaž na EEPROM pamäť.
V prípade, že zariadenie nemá pri prvom spustení nič uložené na uvedených EEPROM offsetoch, automaticky sa vykoná zápis s predvolenými hodnotami - referencia: 20.25 °C, hysteréza 0.25 °C. Toto tzv. fail-safe riešenie zabezpečuje, aby bol termostat okamžite funkčný a pripravený na prevádzku, aj bez ručného nastavenia hodnôt.
Celkový prístup k EEPROM pamäti je optimalizovaný tak, aby prevádzka termostatu bola maximálne šetrná k EEPROM pamäti, s cieľom maximalizovať jej životnosť a zabezpečiť dlhodobú spoľahlivosť.
</p>
<hr>
<p style="text-align: justify;">
Webserver vykonáva obnovu celej stránky každých 30 sekúnd prostredníctvom meta tagu Refresh. Prostredníctvom Javascriptu sa v HTML stránke zobrazuje orientačný čas do ďalšieho obnovenia, pričom používatelia majú 30 sekúnd na vykonanie zmien pre termostat predtým, než sa input okná formulára resetujú pri obnovení stránky. <b>Na základe spätnej väzby od používateľov Android zariadení bol čas pre Refresh predĺžený z 10 na 30 sekúnd.</b>
Vzhľadom k tomu, že built-in knižnica Ethernet neobsahuje využitie asynchrónneho webservera (ktorý je možné využiť napríklad u mikrokontrolérov Espressif ESP8266 / ESP32), je potrebné preposlať celú stránku. Dynamický údaj, ktorý sa najčastejšie mení, je aktuálna hodnota výstupu - <b><font color="#27AE60">Zapnutý</font></b> / <b><font color="red">Vypnutý</font></b>, čo informuje prevádzkovateľa o aktuálnom stave výstupu spolu s farebným označením. Logika systému beží nezávisle na webserveri, takže do času refreshu môže byť stav výstupu iný, ako je aktuálne vypísaný vo webaplikácii. Zmena výstupu je ihneď vypísaná napríklad na UART monitor (115200 baud/s).
Na webovej stránke termostatu nájde používateľ aj informácie o uptime zariadenia, teda o tom, ako dlho termostat beží. Uptime je zobrazený v dňoch, hodinách, minútach a sekundách. Tieto informácie umožňujú prevádzkovateľovi monitorovať trvanie činnosti termostatu.
</p>
<div class="alert alert-danger">
	<strong>Autor Ethernet termostatu nezodpovedá za funkčnosť termostatu, poruchu kotla, úraz elektrickým prúdom pri neodbornej montáži termostatu do siete.</strong> Termostat je šírený pod MIT licenciou.
</div>	
<b>Hlavná stránka pre modifikáciu cieľovej teploty a hysterézy - ukážka zapnutého:</b>
<div class="alert alert-info">
	<strong>Ukážkové dáta</strong>
	<li><b>Cieľová teplota:</b>  22.75 °C</li>
	<li><b>Hysteréza:</b>  0.25 °C</li>
	<li><b>Namerané dáta:</b>  22.49 °C</li>
	<li><b>Výstup:</b>  <font color="#27AE60">Zapnutý</font></li>
	<hr>
	<p style="text-align: justify;">
		Termostat vykuruje od nameranej teploty 22.49 °C a nižšej. 
		V prípade dosiahnutia teploty 23.01 °C a vyššej sa výstup vypne, signalizačné relé sa rozpojí a plynový kotol prestáva kúriť. 
		Nastáva dobeh vykurovania a chladnutie miestnosti v ktorej sa vykonávajú merania. 
		Termostat sa opäť aktivuje až pri dosiahnutí teploty 22.49 °C, alebo nižšej.	
	</p>	
</div>
<center>
<hr>
<h4>Plnefunkčný Ethernet termostat s možnosťou nastavenia riadiach dát:</h4>
<hr>
</center>
<div class="alert alert-info">
	<strong>Refresh webového rozhrania automaticky každých 30 sekúnd</strong>
</div>	
<img src="https://i.imgur.com/rzZtoeP.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet termostat - Hlavný prehľad s modifikáciou cieľovej teploty a hysterézy - Vypnutý" title="Ethernet termostat - Hlavný prehľad s modifikáciou cieľovej teploty a hysterézy - Vypnutý">        			
<center>
<hr>
<h4>Validácia používateľského vstupu - zápis do EEPROM pri validných dátach</h4>
<hr>
</center>
<img src="https://i.imgur.com/ZptC0UR.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet termostat - spracovanie údajov z HTML formulára, zápis do EEPROM" title="Ethernet termostat - spracovanie údajov z HTML formulára, zápis do EEPROM"> 
<img src="https://i.imgur.com/dDXd3gA.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet termostat - nesprávny dátový typ používateľského vstupu" title="Ethernet termostat - nesprávny dátový typ používateľského vstupu">        			
<center>
<hr>
<h4>JSON štruktúra s dátami - aktuálna, cieľová teplota a hysteréza</h4>
<hr>
</center>
<center><img src="https://i.imgur.com/iqxV12k.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet termostat - JSON output" title="Ethernet termostat - JSON output"></center>        		
<center>
<hr>
<h4>UART Monitor výstup - logika systému, nastavenie Ethernet adaptéra</h4>
<hr>
</center>
<div class="alert alert-info">
	<strong>Výstup cyklicky každých 10 sekúnd</strong>
</div>	
<center><img src="https://i.imgur.com/DAL1iCe.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet termostat - UART výstup - IP adresa termostatu, logika, stav výstupu" title="Ethernet termostat - UART výstup - IP adresa termostatu, logika, stav výstupu"></center>        		
<hr><center><h4 style="display: none;">Dostupné knižnice pre mikrokontroléry (Arduino)</h4></center><hr>
<div class="alert alert-danger" style="display: none;">
	Archív knižnice (.zip) rozbaliť do <strong>C:/Používatelia/[Používateľ]/Dokumenty/Arduino/libraries</strong>
</div>
<div class="table-responsive" style="display: none;">   
<table class="table" style="border: 1px solid black;">
<thead>
<tr>
<th style="width: 25%">Názov knižnice</th>
<th style="width: 50%">Funkcia knižnice</th>
<th style="width: 25%">Stiahnuť</th>
</tr>
</thead>
<tbody>
<tr>
<td style="width: 25%"><b>Dallas</b></td>
<td style="width: 50%">
<p style="text-align: justify;">
Knižnica pre AVR mikrokontroléry (ATmega) Arduino Uno / Nano / Mega. 
Umožňuje komunikáciu so senzorom Dallas DS18B20 na OneWire zbernici. Možnosť komunikácie po normálnom, alebo parazitnom zapojení. 
</p>
</td>
<td style="width: 25%"><a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/martinius96/termostat-ethernet/tree/master/src/dallas" class="btn btn-success" role="button">Stiahnuť</a></td>
</tr>
</tbody>
</table>
	</div>
<hr>
<h3 style="display: none;"><font color="#2ECC71">Zdrojový kód - Ethernet termostat - automatický režim</font></h3>	
<pre style="background-color:#2ECC71; display: none;">
/*|----------------------------------------------------------|*/
/*|HTTP webserver - FORM - HTML - PROCESSING - EEPROM        |*/
/*|AUTHOR: Martin Chlebovec                                  |*/
/*|EMAIL: martinius96@gmail.com                              |*/
/*|----------------------------------------------------------|*/
#include &lt;avr\wdt.h>
#include &lt;SPI.h>
#include &lt;Ethernet.h>
#include &lt;EEPROM.h>
#include &lt;OneWire.h>
#include &lt;DallasTemperature.h>

#define ONE_WIRE_BUS 5
OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensorsA(&oneWire);
const int rele = 6;
byte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED }; //physical mac address
byte ip[] = { 192, 168, 4, 1 };
EthernetServer server(80); //server port
const char terminator1[2] = " ";
const char terminator3[2] = "?";
const char terminator4[2] = "&";
const char terminator5[2] = "=";
unsigned long cas = 0;

long day = 86400000; // 86400000 milliseconds in a day
long hour = 3600000; // 3600000 milliseconds in an hour
long minute = 60000; // 60000 milliseconds in a minute
long second =  1000; // 1000 milliseconds in a second

float teplota;
String stav = "VYP";

boolean isFloat(String tString) {
  String tBuf;
  boolean decPt = false;

  if (tString.charAt(0) == '+' || tString.charAt(0) == '-') tBuf = &tString[1];
  else tBuf = tString;

  for (int x = 0; x &lt; tBuf.length(); x++)
  {
    if (tBuf.charAt(x) == '.') {
      if (decPt) return false;
      else decPt = true;
    }
    else if (tBuf.charAt(x) &lt; '0' || tBuf.charAt(x) > '9') return false;
  }
  return true;
}


void writeString(char add, String data)
{
  int _size = data.length();
  int i;
  for (i = 0; i &lt; _size; i++)
  {
    EEPROM.write(add + i, data[i]);
  }
  EEPROM.write(add + _size, '\0'); //Add termination null character for String Data
}


String read_String(char add)
{
  int i;
  char data[100]; //Max 100 Bytes
  int len = 0;
  unsigned char k;
  k = EEPROM.read(add);
  while (k != '\0' && len &lt; 500) //Read until null character
  {
    k = EEPROM.read(add + len);
    data[len] = k;
    len++;
  }
  data[len] = '\0';
  return String(data);
}

void setup() {
  String a = read_String(10);
  String b = read_String(100);
  if (a == "" || a == NULL) {
    writeString(100, "0.25");
  }
  if (b == "" || b == NULL) {
    writeString(10, "20.25");
  }
  sensorsA.begin();
  pinMode(rele, OUTPUT);
  digitalWrite(rele, HIGH);
  Serial.begin(115200);
  sensorsA.requestTemperatures();
  delay(2000);
  //Ethernet.begin(mac); //DHCP
  Ethernet.begin(mac, ip); //STATIC IP
  server.begin();
  Serial.println(F("Webaplikaciu vytvoril: Martin Chlebovec"));
  Serial.println(F("Build 1.0.4 z 18. Sep 2021"));
  Serial.println(F("Ethernet shield na IP:"));
  Serial.println(Ethernet.localIP());
  wdt_enable(WDTO_8S);
}

void loop() {
  wdt_reset();
  if ((millis() - cas) >= 10000 || cas == 0) {
    //Ethernet.maintain(); //odkomentovat iba ak sa pouziva Ethernet.begin(mac);
    cas = millis();
    Serial.println(F("Ethernet shield na IP:"));
    Serial.println(Ethernet.localIP());
    teplota = sensorsA.getTempCByIndex(0);
    String referencia = read_String(10);
    String hystereza = read_String(100);
    float referencia_teplota = referencia.toFloat();
    float hystereza_teplota = hystereza.toFloat();
    float minus_hystereza_teplota = (-1 * hystereza_teplota);
    float rozdiel = referencia_teplota - teplota;
    if (rozdiel > hystereza_teplota) {
      Serial.println(F("Kotol zapnuty"));
      stav = "ZAP";
      digitalWrite(rele, LOW);
    } else if (rozdiel &lt; minus_hystereza_teplota) {
      Serial.println(F("Kotol vypnuty"));
      stav = "VYP";
      digitalWrite(rele, HIGH);
    } else {
      Serial.println(F("Rozdiel cielovej a aktuálnej teploty nie je nad, ani pod hysterezou. Stav vystupu sa nemeni."));
      Serial.print(F("Aktualny stav vystupu pre kotol: "));
      Serial.println(stav);
    }
    sensorsA.requestTemperatures();
  }
  EthernetClient client = server.available();
  if (client) {
    while (client.connected()) {
      if (client.available()) {
        String line = client.readStringUntil('\n');
        char str[line.length() + 1];
        line.toCharArray(str, line.length());
        char *method;
        char *request;
        method = strtok(str, terminator1);
        request = strtok(NULL, terminator1);
        if (String(request) == "/") {
          int days = millis() / day ;                                //number of days
          unsigned int hours = (millis() % day) / hour;                       //the remainder from days division (in milliseconds) divided by hours, this gives the full hours
          unsigned int minutes = ((millis() % day) % hour) / minute ;         //and so on...
          unsigned int seconds = (((millis() % day) % hour) % minute) / second;
          //HLAVNA ROOT HTTP STRANKA
          client.println(F("HTTP/1.1 200 OK"));
          client.println(F("Content-Type: text/html"));
          client.println();
          client.println(F("&lt;!DOCTYPE html>"));
          client.println(F("&lt;html>"));
          client.println(F("&lt;head>"));
          client.println(F("&lt;script type='text/javascript'>"));
          client.println(F("window.smartlook||(function(d) {"));
          client.println(F("var o=smartlook=function(){ o.api.push(arguments)},h=d.getElementsByTagName('head')[0];"));
          client.println(F("var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript';"));
          client.println(F("c.charset='utf-8';c.src='https://rec.smartlook.com/recorder.js';h.appendChild(c);"));
          client.println(F("})(document);"));
          client.println(F("smartlook('init', '6beae97f98b9844b761672af23f38fc60b962338');"));
          client.println(F("&lt;/script>"));
          client.println(F("&lt;meta charset='utf-8'>"));
          client.println(F("&lt;meta name='author' content='Martin Chlebovec'>"));
          client.println(F("&lt;meta http-equiv='Refresh' content='30'; />"));
          client.println(F("&lt;meta name='viewport' content='width=device-width, initial-scale=1'>"));
          client.println(F("&lt;link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css'>"));
          client.println(F("&lt;script type='text/javascript'>"));
          client.println(F("var timeleft = 30;"));
          client.println(F("var downloadTimer = setInterval(function(){"));
          client.println(F("if(timeleft &lt;= 0){"));
          client.println(F("clearInterval(downloadTimer);"));
          client.println(F("document.getElementById(\"countdown\").innerHTML = \"Refresh...\";"));
          client.println(F("} else {"));
          client.println(F("document.getElementById(\"countdown\").innerHTML = timeleft + \" sekúnd do refreshu\";"));
          client.println(F("}"));
          client.println(F("timeleft -= 1;"));
          client.println(F("}, 1000);"));
          client.println(F("&lt;/script>"));
          client.println(F("&lt;title>HTTP webserver - Arduino + Ethernet&lt;/title>"));
          client.println(F("&lt;/head>"));
          client.println(F("&lt;body>"));
          client.println(F("&lt;center>&lt;h3>Zadajte dáta pre webserver (budú uložené do EEPROM):&lt;/h3>"));
          client.println(F("&lt;form action='/action.html' method='get'>"));
          client.println("&lt;b>Referenčná teplota:&lt;/b>&lt;br>&lt;input type='text' id='fname' name='fname' value=" + read_String(10) + ">&lt;br>");
          client.println("&lt;b>Hysteréza:&lt;/b>&lt;br>&lt;input type='text' id='fname2' name='fname2' value=" + read_String(100) + ">&lt;br>");
          client.println(F("&lt;input type='submit' class='btn btn-success' value='Zapísať'>"));
          client.println(F("&lt;/form>&lt;hr>"));
          if (stav == "ZAP") {
            client.println(F("&lt;b>&lt;font color='green'>Výstup: Zapnutý&lt;/font>&lt;/b>"));
          }
          if (stav == "VYP") {
            client.println(F("&lt;b>&lt;font color='red'>Výstup: Vypnutý&lt;/font>&lt;/b>"));
          }
          client.println(F("&lt;div id=\"countdown\">&lt;/div>"));
          client.print(F("&lt;b>Aktuálna teplota senzora DS18B20:&lt;/b> "));
          client.print(teplota);
          client.println(F(" °C"));
          client.print(F("&lt;hr>"));
          client.print(F("&lt;b>Uptime: &lt;/b>"));
          client.print(days);
          client.print(F("d"));
          client.print(F(" "));
          client.print(hours);
          client.print(F("h"));
          client.print(F(" "));
          client.print(minutes);
          client.print(F("m"));
          client.print(F(" "));
          client.print(seconds);
          client.print(F("s"));
          client.println(F("&lt;h3>Autor: Martin Chlebovec - martinius96@gmail.com - https://martinius96.github.io/termostat-ethernet/&lt;/h3>"));
          client.println(F("&lt;h4>Verzia free - 1.0.4 build: 18. Sep. 2021&lt;/h4>"));
          client.println(F("&lt;/center>"));
          client.println(F("&lt;/body>"));
          client.println(F("&lt;/html>"));
          delay(1);
          client.stop();
          client.flush();
        } else if (String(request) == "/get_data.json") {
          //PODSTRANKA PRE VYCITANIE DAT (INYM MIKROKONTROLEROM)
          client.println(F("HTTP/1.1 200 OK"));
          client.println(F("Content-Type: application/json"));
          client.println();
          client.println(F("{"));
          client.print(F("\"Hysteresis\":"));
          client.print(read_String(100));
          client.println(F(","));
          client.print(F("\"Target_Temperature\":"));
          client.print(read_String(10));
          client.println(F(","));
          client.print(F("\"Actual_Temperature\":"));
          client.println(String(teplota));
          client.println(F("}"));
          delay(1);
          client.stop();
          client.flush();
        } else if (String(request) == "/favicon.ico") { //fix chybajuceho faviconu
          client.stop();
        } else {
          String myString = String(request);
          if (myString.startsWith("/action.html")) {
            char* parameter;
            char* value;
            char* hodnota1;
            char* hodnota2;
            parameter = strtok(request, terminator3);
            Serial.println(parameter);
            value = strtok(NULL, terminator3);
            hodnota1 = strtok(value, terminator4);
            hodnota2 = strtok(NULL, terminator4);
            char* H_1;
            char* H_2;
            strtok(hodnota1, terminator5);
            H_1 = strtok(NULL, terminator5);
            strtok(hodnota2, terminator5);
            H_2 = strtok(NULL, terminator5);
            String first_param = String(H_1);
            String second_param = String(H_2);
            if (isFloat(first_param)) {
              writeString(10, String(H_1));
            } else {
              Serial.println(F("Pouzivatelsky vstup pre kluc fname (Cielova teplota) nie je cislo!"));
            }
            if (isFloat(second_param)) {
              writeString(100, String(H_2));
            } else {
              Serial.println(F("Pouzivatelsky vstup pre kluc fname2 (Hystereza) nie je cislo!"));
            }
            client.println(F("HTTP/1.1 200 OK"));
            client.println(F("Content-Type: text/html"));
            client.println();
            client.println(F("&lt;!DOCTYPE html>"));
            client.println(F("&lt;html>"));
            client.println(F("&lt;head>"));
            client.println(F("&lt;meta charset='utf-8'>"));
            client.println(F("&lt;meta http-equiv='Refresh' content='5; url=/' />"));
            client.println(F("&lt;title>HTTP webserver - Arduino + Ethernet&lt;/title>"));
            client.println(F("&lt;/head>"));
            client.println(F("&lt;body>"));
            client.println(F("&lt;center>&lt;h3>Server prijal data z formulára:&lt;/h3>"));
            if (!isFloat(second_param) || !isFloat(second_param)) {
              client.println(F("&lt;h3>&lt;font color='red'>Zadane udaje nie su cisla!!! Opakujte pokus po presmerovaní.&lt;/font>&lt;/h3>"));
            } else {
              client.println("&lt;li>&lt;b>Referenčná teplota: &lt;/b>" + String(H_1) + "&lt;/li>");
              client.println("&lt;li>&lt;b>Hysteréza: &lt;/b>" + String(H_2) + "&lt;/li>");
            }
            client.println(F("&lt;b>Presmerovanie... Prosim cakajte&lt;/b>&lt;/center>"));
            client.println(F("&lt;/body>"));
            client.println(F("&lt;/html>"));
            delay(1);
            client.stop();
            client.flush();
          } else {
            client.println(F("HTTP/1.1 404 Not Found"));
            client.println();
            delay(1);
            client.stop();
            client.flush();
          }
        }
      }
    }
  }
}

</pre>
<p style="text-align: justify;"> 
Implementácia obsahuje programy pre statickú / dynamickú IPv4 adresu priradenú k Ethernet shieldu. 
<b>Termostat je určený iba pre interiérové teploty!</b> (nad 0°C), čomu je prispôsobená aj logika systému! 
Termostatom je možné nahradiť už existujúci izbový termostat, možno dočasne nahradiť ohrievač v akváriu / teráriu pre udržiavanie stálej teploty.
</p>	
 </div>
		</div>
</div>
</body>
        <script>
$(document).ready(function(){
  $('[data-toggle="tooltip2"]').tooltip();   
});
</script>
</html>
