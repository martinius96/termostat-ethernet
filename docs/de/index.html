<!DOCTYPE html>
<html lang="de-DE">
<head>
	<!-- Primary Meta Tags -->
	<title>Raumthermostat zur Kesselsteuerung mit Webanwendung - Webserver - Arduino + Ethernet Wiznet W5100 / W5500</title>
	<meta name="description" content="Raumthermostat entwickelt auf der Arduino Uno-Plattform + Ethernet-Schild Wiznet W5100 / W5500. Thermostat zum Heizen / Kühlen.">
	<meta name="keywords" content="Termostat, digitálny, arduino, wiznet, ethernet, w5100, w5500, vykurovanie, kúrenie, webserver, socket, http, web, ip, ipv4, ds18b20, onewire, 1-wire">
	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://martinius96.github.io/termostat-ethernet/de/">
	<meta property="og:title" content="Raumthermostat zur Kesselsteuerung mit Webanwendung - Webserver - Arduino + Ethernet Wiznet W5100 / W5500">
	<meta property="og:description" content="Raumthermostat entwickelt auf der Arduino Uno-Plattform + Ethernet-Schild Wiznet W5100 / W5500. Thermostat zum Heizen / Kühlen.">

	<!-- Twitter -->
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:url" content="https://martinius96.github.io/termostat-ethernet/de/">
	<meta property="twitter:title" content="Raumthermostat zur Kesselsteuerung mit Webanwendung - Webserver - Arduino + Ethernet Wiznet W5100 / W5500">
	<meta property="twitter:description" content="Raumthermostat entwickelt auf der Arduino Uno-Plattform + Ethernet-Schild Wiznet W5100 / W5500. Thermostat zum Heizen / Kühlen.">
	
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="sitemap" type="application/xml" title="Sitemap" href="../../sitemap.xml" />
	<meta name="google-site-verification" content="UwZZh2EXv3iWUAi_1Z0hLxVCz6ySJ4UdY_BPoLtejwo" />    	
	<meta property='fb:admins' content='100001242570317'>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/arduino-light.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/arduino.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>    
			 <style>
  pre {
  counter-reset: line-numbering;
  background: #2c3e50;
  padding: 12px 0px 14px 0;
  color: #ecf0f1;
  line-height: 100%;
}

pre .line::before {
  content: counter(line-numbering);
  counter-increment: line-numbering;
  padding-right: 1em;
  /* space after numbers */
  padding-left: 8px;
  width: 1.5em;
  text-align: right;
  opacity: 0.5;
  color: white;
}
  </style>
			<style>
	#right {
  position: absolute;
  right: 0px;
}
	</style>
</head>
<body>
	<div class="container">
  		<div class="row">
    			<div class="col-sm-12">
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Thermostat - Ethernet</a>
    </div>
    <ul class="nav navbar-nav">
      	<li class="active"><a href="index.html">Überblick</a></li>
	<li><a href="zapojenie.html">Beteiligung</a></li>      
	<li class=""><a href="spustenie.html">Firmware</a></li>
  <li><a href="json_client.html">JSON-Client</a></li>
      	<li><a href="kontakt.html">Kontakt</a></li>
<li><a href="phy_ethernet.html">ESP32 + PHY</a></li>
<a href="../index.html"><img src="https://futbalovysen.sk/wp-content/uploads/slovakia.png" alt="Slovak flag.png, 2,2kB" title="Slovakia" height="32" width="32"></a>	
<a href="../en/index.html"><img src="https://i2.wp.com/facsusa.com/wp-content/uploads/2017/05/Flag-of-England.png?ssl=1" alt="English.png, 2,2kB" title="English" height="32" width="32"></a>
	 <li style="float: right; "><a href="https://martinius96.github.io/WiFi-termostat/de/" class="btn btn-success" role="button" title="Ändern Sie das Projekt in einen WiFi-Thermostat"><img src="https://www.flaticon.com/premium-icon/icons/svg/3686/3686730.svg" width=16px height=16px> <font color="white">WiFi-Thermostat</font></a></li> 
</ul>
  </div>
</nav>  
<div class="alert alert-success">
	<strong>Projekt-Repository für Ethernet-Thermostate - Maschinencodes: </strong><a href="https://github.com/martinius96/termostat-ethernet/tree/master/firmware">Github</a>
</div>	
<div class="alert alert-danger">
	<strong>Version 1.0.4 des Ethernet-Thermostat-Projekts ist das neueste kostenlose Versions-Update. Andere Fehler, Fehler und Sicherheitsfehler werden nicht behoben!</strong>
</div>	
<div class="alert alert-success">
	<strong>Die Firmware für den Ethernet-Thermostat ist vollständig in der deutschen Sprachversion verfügbar.</strong>
</div>		
<div class="alert alert-info">
 	<strong>Unterstützen Sie das Ethernet-Thermostat-Projekt über PayPal. Der Support ermöglicht es Ihnen, in Zukunft neue Funktionen hinzuzufügen und den Quellcode der Anwendung zu öffnen: </strong><a href="https://www.paypal.com/paypalme/chlebovec" class="btn btn-primary" role="button">PayPal donate</a>
</div>	
<span class="label label-default">Arduino</span>
<span class="label label-primary">Ethernet</span>
<span class="label label-success">Wiznet W5100 / W5500</span>
<span class="label label-info">DS18B20</span>
<span class="label label-warning">OneWire</span>
<span class="label label-danger">Dallas</span>
<span class="label label-default">HTML</span>
<span class="label label-primary">Webserver</span>
<span class="label label-success">WebSocket</span>
<hr><h4>Kompatible Steuerungshardware für Ethernet-Thermostat:</h4><hr>
<div class="row">
<div class="col-sm-3"><center><img src="https://i.imgur.com/wtnzKqO.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler Arduino UNO" title="Riadiaci mikrokontróler Arduino UNO"><br><b><a href="https://www.ebay.com/itm/254532156570">Arduino UNO</a></b></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/XHC8DBe.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler Arduino Nano" title="Riadiaci mikrokontróler Arduino Nano"><br><b><a href="https://www.ebay.com/itm/252742123829">Arduino Nano</a></b></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/4xX0BoE.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler ATmega328P DIP" title="Riadiaci mikrokontróler ATmega328P DIP"><br><b><a href="https://www.ebay.com/itm/292204064766">ATmega328P - DIP28</a></b></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/FANTMuW.png" width="128px" height="128px" style="border-radius: 50%;" alt="Riadiaci mikrokontróler ATmega328P SMD" title="Riadiaci mikrokontróler ATmega328P SMD"><br><b><a href="https://www.ebay.com/itm/142666414237">ATmega328P - SMD</a></b></center></div>
</div>	
<hr><h4>Kompatible Ethernet-Module und -Abschirmungen für Ethernet-Thermostat:</h4><hr>
<div class="row">
<div class="col-sm-3"><center><img src="https://i.imgur.com/aaS35X2.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet shield Wiznet W5100" title="Ethernet shield Wiznet W5100"><br><b><a href="https://www.ebay.com/itm/185017231005">Ethernet Wiznet W5100</a></b></center></div>
<div class="col-sm-3"><center><img src="https://i.imgur.com/GaZYxl0.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet modul Wiznet W5200" title="Ethernet modul Wiznet W5200"><br><b><a href="https://www.ebay.com/itm/324571412234">Ethernet Wiznet W5200</a></b></center></div> 
<div class="col-sm-3"><center><img src="https://i.imgur.com/rME7SWd.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet modul Wiznet W5200" title="Ethernet modul Wiznet W5300"><br><b><a href="https://www.ebay.com/itm/113814097639">Ethernet Wiznet W5300</a></b></center></div>   
<div class="col-sm-3"><center><img src="https://i.imgur.com/mz4dhRA.png" width="128px" height="128px" style="border-radius: 50%;" alt="Ethernet modul Wiznet W5500" title="Ethernet modul Wiznet W5500"><br><b><a href="https://www.ebay.com/itm/263116282333">Ethernet Wiznet W5500</a></b></center></div>
</div>				
<hr><center><h1>Raumthermostat - Arduino + Ethernet Wiznet</h1></center><hr>
<p style="text-align: justify;">
Arduino ist eine praktische eingebettete Plattform, mit der beispielsweise ein Raumthermostat mit Ethernet-Konnektivität und einem auf Arduino implementierten Webserver erstellt werden kann.
Die Implementierung verwendet Arduino Uno / Nano mit AVR ATmega328P-Chip in Kombination mit dem Ethernet-Shield Wiznet W5100 / W5500, mit dem es über SPI-Bus kommuniziert, resp. ICSP-Header.
Der Thermostat arbeitet programmgesteuert im Webserver-Modus, wo er über das HTTP-Protokoll Anfragen von Clients im Netzwerk empfangen und ihnen eine Antwort senden kann - HTML / JSON-Code und die Backend-Funktion (Funktionalität) ausführen, wenn sie gestartet werden.
Der Thermostat ist über das LAN-Netzwerk, in dem er sich befindet, zugänglich, während er mit einer Webschnittstelle ausgestattet ist, mit der alle Elemente des Thermostats konfiguriert werden können, d. Soll-(Referenz-)Temperatur und Hysterese.
Der Webserver ermöglicht den Betrieb mehrerer unabhängiger HTML-Seiten, die informativ oder sogar funktional sein können (implementiertes Backend).
Der Webserver läuft auf einem Standard-HTTP-Port - 80.
Der Thermostat kann über den GPIO-Ausgang automatisch das Melderelais zum Ein-/Ausschalten des Kessels ansteuern.
Es kann somit ein vorhandenes Raumthermostat ersetzen und den Clients im Netzwerk zur Verfügung stellen.
Der Thermostat kann jedes Gerät mit einem Browser bedienen - Computer / Smartphone / Tablet / Smart TV und dergleichen.
Der Entscheidungsalgorithmus verwendet eine Solltemperatur mit Hysterese, die mit der von einem digitalen Temperatursensor Dallas DS18B20 gemessenen Temperatur verglichen wird.
Solltemperatur und Hysterese werden aus dem EEPROM-Speicher gelesen, wo sie auch bei Stromausfall dauerhaft gespeichert und beim Schreiben neuer Daten überschrieben werden.
<b> Die Auflösung des DS18B20-Sensors bei der Messung beträgt 12 Bit, was durch die Auflösung bis zu Temperaturen von 0,0625 ° C angegeben wird, was der minimale Auflösungsschritt zwischen verschiedenen Messungen ist.
Daten über den OneWire-Bus können bei Bedarf in 500 bis 1000 ms zum Mikrocontroller kommen, abhängig von der Anzahl der Sensoren am OneWire-Bus, der Länge des Busses usw. ... </b>
Die Entscheidungslogik des Thermostats wird alle 10 Sekunden unabhängig von der Webanwendung ausgeführt, es ist keine Keep-Alive-Verbindung erforderlich, um die Logik auszuführen, so dass das System autonom arbeitet und keine Aufmerksamkeit des Benutzers erfordert.
</p>
<b>In Bezug auf die Hardware verwendet das Projekt:</b>
<li>Arduino Uno</li>
<li>Ethernet-Abschirmung Wiznet W5100 / Ethernet-Modul Wiznet W5200-W5500 </li>
<li>Temperatursensor DS18B20 am OneWire-Bus im TO-92-Gehäuse oder in wasserdichter Ausführung im Aluminiumrohr </li>
<li> Elektromagnetisches Relais SRD-5VDC-SL-C / SSR-Relais OMRON G3MB-202P zur Kesselschaltung (Active-LOW-Signal) </li>
<p style="text-align: justify;">
<b> HTML-Seiten, die auf Arduino ausgeführt werden: </b>
<li> <b> / </b> - Grundseite mit Formular, aktueller Logikausgang für Relais, Temperatur </li>
<li> <b> /action.html </b> - verarbeitet Werte aus dem Formular, schreibt sie in den EEPROM-Speicher, leitet den Benutzer zurück zur Stammseite </li>
<li> <b> /get_data.json </b> - verteilt aktuelle Temperatur-, Referenztemperatur- und Hysteresedaten an Dritte (Computer, Mikrocontroller, anderer Client ...) im JSON-Format </li>
<hr>				
Das im Projekt verwendete elektromagnetische Relais SRD-5VDC-SL-C ermöglicht das Schalten von bis zu 10A bei 230V - maximale Leistung 2300W.
Beim Schalten eines Gleichstromkreises (Last) können 300W (10A bei 30V DC max.) geschaltet werden.
Das OMRON G3MB-202P SSR-Relais ist auch voll kompatibel zum Schaltplan, der nur für nicht induktive Lasten und ausschließlich für AC-Lasten geeignet ist (DC-Kreis kann nach dem Einschalten nicht öffnen).
Maximale Schaltleistung 460W (230V, 2A). <b> Der Thermostat kann das ganze Jahr über verwendet werden. Im Falle einer unnötigen Steuerung kann der Ausgang physisch getrennt werden und der Thermostat kann als Ethernet-Thermometer verwendet werden, um Daten aus dem Raum zu erhalten, in dem er sich befindet. </b>
</p>
<img src="https://i.imgur.com/pwZqOfS.jpg" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - Arduino + Wiznet W5100/W5500 - webserver" title="Ethernet thermostat - Arduino + Wiznet W5100/W5500 - webserver">
<b> Die Webschnittstelle für den Ethernet-Thermostat ermöglicht Ihnen: </b>
<li> Sehen Sie in Echtzeit die Temperatur des DS18B20-Sensors, die Betriebszeit des Geräts, den Ausgabewert mit dynamischer Änderung, die aktuell eingestellten Konfigurationsdaten für den Thermostat, d. Solltemperatur und Hysterese </li>
<li>Ändern Sie die Zieltemperatur (Referenztemperatur) von 5 bis 50 °C in Schritten von 0,25 °C <img src="https://i.imgur.com/zMsp0cr.png" width="20px" height="20px" data-toggle="tooltip2" data-placement="right" title="Umfang in Version 1.0.2 aufgrund der Unterstützung von Nicht-Dezimalkomma für die Eingabetypnummer auf Android-Betriebssystem entfernt"></li>
<li> Ändern Sie die Hysterese von 0 bis 10 °C in Schritten von 0,25 °C <img src="https://i.imgur.com/zMsp0cr.png" width="20px" height="20px" data-toggle="tooltip2" data-placement="right" title="Umfang in Version 1.0.2 aufgrund der Unterstützung von Nicht-Dezimalkomma für die Eingabetypnummer auf Android-Betriebssystem entfernt"></li>

<b> Kessel EIN / AUS-Steuerung: </b>
<li>Beispiel für EIN / AUS der Heizungssteuerung - <font color = "red"> VISUALISIERUNG IST NICHT TEIL DES PROJEKTS </font> </li>
<li>Der Kessel ist aktiv, solange die Solltemperatur + Hysterese erreicht ist </li>
<li> Die Visualisierung von Wassertemperaturen zeigt die sogenannte Heizlauf und anschließendes Abkühlen des Wassers bis die Heizung wieder aktiviert wird, wenn die gemessene Temperatur unter der eingestellten Solltemperatur liegt - Hysterese </li>
<img src="https://i.imgur.com/IDWLuOr.png" style="display: block; max-width: 100%; height: auto;" alt="ZAP/VYP regulácia kotla s hysterézou" title="ZAP/VYP regulácia kotla s hysterézou">        			    
<p style="text-align: justify;">
Die Weboberfläche ist für größere und kleinere Bildschirme ausgelegt. Es ist reaktionsschnell, unterstützt Breitbild-High-Definition-Bildschirme, aber auch mobile Geräte.
Die Schnittstelle verwendet importierte CSS-Stile des Bootstrap-Frameworks von einem externen CDN-Server, der das clientseitige Gerät lädt, wenn eine Seite geöffnet wird, die auf Arduino ausgeführt wird.
Da der Arduino Uno speicherbegrenzt ist, kann er nur Seiten mit einer Größe von wenigen KB ausführen. Durch den Import von CSS-Stilen von einem externen Server können Sie die Leistung und Speicherbelastung von Arduino reduzieren.
Die Software-Implementierung (für Arduine Uno) verwendet ca. 70% des Flash-Speichers (32kB - 4kB Bootloader) und 44% des RAM-Speichers (2kB).
Statische Teile einer Webseite (HTML-Dokument-Header und -Fußzeile, Bootstrap-CSS-Verknüpfung, Meta-Tags, HTTP-Response-Header, Inhaltstyp, Formular und mehr) werden direkt im Flash-Speicher von Arduino gespeichert, was den für den Benutzer verwendeten RAM erheblich reduzieren kann -generierte Inhalte.
Der Webserver ist dadurch stabiler und kann die Mehrfachverbindung mehrerer Geräte im Netzwerk gleichzeitig verarbeiten. Der Verbrauch des gesamten Thermostats beträgt bis zu 200 mA bei 5V Versorgung - unter 1W.
</p>
<hr>
<p style="text-align: justify;">
Um die eingestellten Werte auch nach einem Stromausfall beizubehalten, werden diese im EEPROM-Speicher des Arduino (insgesamt 512 B) abgelegt.
Die Referenztemperatur wird auf Offset 10 geschrieben, Hysterese auf Offset 100. Jeder der Werte belegt maximal 5B im EEPROM-Speicher + Terminator.
Die EEPROM-Transkriptionsgrenze liegt bei 100.000 Transkripten. Daten werden nur überschrieben, wenn das HTML-Formular gesendet wird. Der Betrieb des Thermostaten schont somit den EEPROM-Speicher, um dessen Lebensdauer zu maximieren.
Wenn das Gerät beim ersten Start nichts auf den genannten EEPROM-Offsets gespeichert hat, wird automatisch mit Standardwerten geschrieben - Referenz: 20,25 ° C, Hysterese 0,25 ° C, sog. ausfallsichere Lösung, damit der Thermostat sofort funktions- und betriebsbereit ist.
</p>
<p style="text-align: justify;">
Mit dem Refresh-Meta-Tag aktualisiert der Webserver alle 30 Sekunden die gesamte Seite und die ungefähre Aktualisierungszeit wird ebenfalls per Javascript in die HTML-Seite geschrieben.
Zu diesem Zeitpunkt ist es notwendig, die Änderung für den Thermostaten zu schreiben, da sonst die Eingabefenster für numerische Eingaben in das Formular beim Aktualisieren der Seite zurückgesetzt werden. <b> Basierend auf dem Feedback von Nutzern von Android-Geräten wurde die Aktualisierungszeit von 10 auf 30 Sekunden verlängert. </b>
Da die eingebaute Ethernet-Bibliothek die Verwendung eines asynchronen Webservers (der beispielsweise mit den Espressif ESP8266 / ESP32 Mikrocontrollern verwendet werden kann) nicht beinhaltet, ist es notwendig die gesamte Seite neu zu schreiben.
Die sich hauptsächlich ändernden dynamischen Daten sind der aktuelle Wert der Ausgabe - <b> <font color = "#27AE60"> EIN </font> </b> / <b> <font color = "red"> AUS </font> </b>, die den Bediener über den aktuellen Zustand der Ausgabe zusammen mit der Farbcodierung informiert.
Da die Logik des Systems unabhängig vom Webserver ausgeführt wird, kann sich die Ausgabe bereits in einem anderen Zustand befinden als aktuell in der Webanwendung aufgelistet. Die Ausgabeänderung wird z. B. sofort auf den UART-Monitor (115200 baud/s) geschrieben.
Auf der Website des Thermostats findet der Benutzer auch Informationen zur Betriebszeit des Geräts (wie lange es in Betrieb war), d. Zeit in Tagen, Stunden, Minuten und Sekunden.
</p>
<div class="alert alert-danger">
	<strong>Der Autor des Ethernet-Thermostats ist nicht verantwortlich für die Funktionalität des Thermostats, Kesselausfall, Stromschlag aufgrund einer unsachgemäßen Installation des Thermostats im Netzwerk. </strong> Der Thermostat wird unter der MIT-Lizenz vertrieben.
</div>	
<b> Hauptseite zur Änderung der Solltemperatur und der Hysterese - Ausgabe am Beispiel: </b>
<div class="alert alert-info">
<strong> Beispieldaten </strong>
<li> <b>Zieltemperatur: </b>22.75 °C</li>
<li> <b>Hysterese: </b> 0.25 ° C </li>
<li> <b>Messdaten: </b> 22.49 ° C </li>
<li> <b> Ausgang: </b> <font color="#27AE60">EIN</font></li>
	<hr>
	<p style="text-align: justify;">
Der Thermostat heizt ab einer gemessenen Temperatur von 22.49 °C und darunter.
Wenn die Temperatur 23.01 °C erreicht, wird der Ausgang ausgeschaltet, das Melderelais öffnet und der Gaskessel hört auf zu heizen.
Das Aufheizen und Abkühlen des Raumes, in dem die Messungen durchgeführt werden, erfolgt. 
Der Thermostat wird erst wieder aktiviert, wenn die Temperatur 22.49 °C oder niedriger erreicht.	
	</p>	
</div>
<img src="https://i.imgur.com/7kqMGCU.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - Main dashboard - Arduino" title="Ethernet thermostat - Main dashboard - Arduino">        			
<b>Verarbeitung gültiger und ungültiger Daten aus HTML-Formular:</b>
<img src="https://i.imgur.com/dldZnS3.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - processing HTML form with valid datas" title="Ethernet thermostat - processing HTML form with valid datas">  
<img src="https://i.imgur.com/5hLRENj.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - processing HTML form without valid datas" title="Ethernet thermostat - processing HTML form without valid datas">       			
<b>JSON-Ausgabe von Ziel, gemessener Temperatur und Hysterese:</b>
<center><img src="https://i.imgur.com/XuJWC2a.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - JSON output" title="Ethernet thermostat - JSON output"></center>        		
<b>Ausgabe an UART-Monitor - Zustände der Ausgänge, Einstellung des Ethernet-Adapters:</b>
<center><img src="https://i.imgur.com/6CYuMZZ.png" style="display: block; max-width: 100%; height: auto;" alt="Ethernet thermostat - UART" title="Ethernet thermostat - UART"></center>        		
<hr><center><h4>Verfügbare Bibliotheken für Mikrocontroller (Arduino)</h4></center><hr>
<div class="alert alert-danger">
	Bibliotheksarchiv (.zip) expandieren zu <strong>C:/Users/[User]/Documents/Arduino/libraries</strong>
</div>
<div class="table-responsive">   
<table class="table" style="border: 1px solid black;">
<thead>
<tr>
<th style="width: 25%">Name der Bibliothek</th>
<th style="width: 50%">Bibliotheksfunktion</th>
<th style="width: 25%">Herunterladen</th>
</tr>
</thead>
<tbody>
<tr>
<td style="width: 25%"><b>Dallas</b></td>
<td style="width: 50%">
<p style="text-align: justify;">
Bibliothek für AVR-Mikrocontroller (ATmega) Arduino Uno / Nano / Mega.
Es ermöglicht die Kommunikation mit dem Dallas DS18B20-Sensor auf dem OneWire-Bus. Kommunikationsmöglichkeit nach normaler oder parasitärer Verbindung.
</p>
</td>
<td style="width: 25%"><a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/martinius96/termostat-ethernet/tree/master/src/dallas" class="btn btn-success" role="button">Herunterladen</a></td>
</tr>
</tbody>
</table>
	</div>
<hr><h2>Quellcode - Ethernet-Thermostat - Automatikmodus</h2><hr>
<pre><code>
/*|----------------------------------------------------------|*/
/*|HTTP webserver - FORM - HTML - PROCESSING - EEPROM        |*/
/*|AUTHOR: Martin Chlebovec                                  |*/
/*|EMAIL: martinius96@gmail.com                              |*/
/*|DONATE: paypal.me/chlebovec                               |*/
/*|----------------------------------------------------------|*/
#include &lt;avr\wdt.h>
#include &lt;SPI.h>
#include &lt;Ethernet.h> //Wiznet W5100
//#include &lt;Ethernet2.h> //Wiznet W5500
#include &lt;EEPROM.h>
#include &lt;OneWire.h>
#include &lt;DallasTemperature.h>

#define ONE_WIRE_BUS 5
OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensorsA(&oneWire);
const int rele = 6;
byte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED }; //physical mac address
EthernetServer server(80); //server port
const char terminator1[2] = " ";
const char terminator3[2] = "?";
const char terminator4[2] = "&";
const char terminator5[2] = "=";
unsigned long cas = 0;

long day = 86400000; // 86400000 milliseconds in a day
long hour = 3600000; // 3600000 milliseconds in an hour
long minute = 60000; // 60000 milliseconds in a minute
long second =  1000; // 1000 milliseconds in a second

float teplota;
String stav = "AUS";

boolean isFloat(String tString) {
  String tBuf;
  boolean decPt = false;

  if (tString.charAt(0) == '+' || tString.charAt(0) == '-') tBuf = &tString[1];
  else tBuf = tString;

  for (int x = 0; x &lt; tBuf.length(); x++)
  {
    if (tBuf.charAt(x) == '.') {
      if (decPt) return false;
      else decPt = true;
    }
    else if (tBuf.charAt(x) &lt; '0' || tBuf.charAt(x) > '9') return false;
  }
  return true;
}


void writeString(char add, String data)
{
  int _size = data.length();
  int i;
  for (i = 0; i &lt; _size; i++)
  {
    EEPROM.write(add + i, data[i]);
  }
  EEPROM.write(add + _size, '\0'); //Add termination null character for String Data
}


String read_String(char add)
{
  int i;
  char data[100]; //Max 100 Bytes
  int len = 0;
  unsigned char k;
  k = EEPROM.read(add);
  while (k != '\0' && len &lt; 500) //Read until null character
  {
    k = EEPROM.read(add + len);
    data[len] = k;
    len++;
  }
  data[len] = '\0';
  return String(data);
}

void setup() {
  String a = read_String(10);
  String b = read_String(100);
  if (a == "" || a == NULL) {
    writeString(10, "20.25");
  }
  if (b == "" || b == NULL) {
    writeString(100, "0.25");
  }
  sensorsA.begin();
  pinMode(rele, OUTPUT);
  digitalWrite(rele, HIGH);
  Serial.begin(115200);
  sensorsA.requestTemperatures();
  delay(2000);
  Ethernet.begin(mac);
  server.begin();
  Serial.println(F("Webanwendung erstellt: Martin Chlebovec"));
  Serial.println(F("Build 1.0.4 z 18. Sep 2021"));
  Serial.println(F("IP-Adresse des Ethernet-Thermostats:"));
  Serial.println(Ethernet.localIP());
  wdt_enable(WDTO_8S);
}

void loop() {
  wdt_reset();
  if ((millis() - cas) >= 10000 || cas == 0) {
    cas = millis();
    Serial.println(F("IP-Adresse des Ethernet-Thermostats:"));
    Serial.println(Ethernet.localIP());
    teplota = sensorsA.getTempCByIndex(0);
    String referencia = read_String(10);
    String hystereza = read_String(100);
    float referencia_teplota = referencia.toFloat();
    float hystereza_teplota = hystereza.toFloat();
    float minus_hystereza_teplota = (-1 * hystereza_teplota);
    float rozdiel = referencia_teplota - teplota;
    if (rozdiel > hystereza_teplota) {
      Serial.println(F("Ausgang ein"));
      stav = "EIN";
      digitalWrite(rele, LOW);
    } else if (rozdiel &lt; minus_hystereza_teplota) {
      Serial.println(F("Ausgang aus"));
      stav = "AUS";
      digitalWrite(rele, HIGH);
    } else {
      Serial.println(F("Die Differenz zwischen Soll- und Ist-Temperatur liegt nicht über oder unter der Hysterese. Der Ausgangszustand ändert sich nicht."));
      Serial.print(F("Aktuelle Leistung des Kessels: "));
      Serial.println(stav);
    }
    Ethernet.maintain();
    sensorsA.requestTemperatures();
  }
  EthernetClient client = server.available();
  if (client) {
    while (client.connected()) {
      if (client.available()) {
        String line = client.readStringUntil('\n');
        char str[line.length() + 1];
        line.toCharArray(str, line.length());
        char *method;
        char *request;
        method = strtok(str, terminator1);
        request = strtok(NULL, terminator1);
        if (String(request) == "/") {
          int days = millis() / day ;                                //number of days
          unsigned int hours = (millis() % day) / hour;                       //the remainder from days division (in milliseconds) divided by hours, this gives the full hours
          unsigned int minutes = ((millis() % day) % hour) / minute ;         //and so on...
          unsigned int seconds = (((millis() % day) % hour) % minute) / second;
          //HLAVNA ROOT HTTP STRANKA
          client.println(F("HTTP/1.1 200 OK"));
          client.println(F("Content-Type: text/html"));
          client.println();
          client.println(F("&lt;!DOCTYPE html>"));
          client.println(F("&lt;html>"));
          client.println(F("&lt;head>"));
          client.println(F("&lt;meta charset='utf-8'>"));
          client.println(F("&lt;meta name='author' content='Martin Chlebovec'>"));
          client.println(F("&lt;meta http-equiv='Refresh' content='30'; />"));
          client.println(F("&lt;meta name='viewport' content='width=device-width, initial-scale=1'>"));
          client.println(F("&lt;link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css'>"));
          client.println(F("&lt;script type='text/javascript'>"));
          client.println(F("var timeleft = 30;"));
          client.println(F("var downloadTimer = setInterval(function(){"));
          client.println(F("if(timeleft &lt;= 0){"));
          client.println(F("clearInterval(downloadTimer);"));
          client.println(F("document.getElementById(\"countdown\").innerHTML = \"Aktualisierung...\";"));
          client.println(F("} else {"));
          client.println(F("document.getElementById(\"countdown\").innerHTML = timeleft + \" Sekunden zum Aktualisieren\";"));
          client.println(F("}"));
          client.println(F("timeleft -= 1;"));
          client.println(F("}, 1000);"));
          client.println(F("&lt;/script>"));
          client.println(F("&lt;title>HTTP webserver - Arduino + Ethernet&lt;/title>"));
          client.println(F("&lt;/head>"));
          client.println(F("&lt;body>"));
          client.println(F("&lt;center>&lt;h3>Daten für Webserver eingeben (wird im EEPROM gespeichert):&lt;/h3>"));
          client.println(F("&lt;form action='/action.html' method='get'>"));
          client.println("&lt;b>Zieltemperatur:&lt;/b>&lt;br>&lt;input type='text' id='fname' name='fname' value=" + read_String(10) + ">&lt;br>");
          client.println("&lt;b>Hysterese:&lt;/b>&lt;br>&lt;input type='text' id='fname2' name='fname2' value=" + read_String(100) + ">&lt;br>");
          client.println(F("&lt;input type='submit' class='btn btn-success' value='Schreiben'>"));
          client.println(F("&lt;/form>&lt;hr>"));
          if (stav == "EIN") {
            client.println(F("&lt;b>&lt;font color='green'>Ausgang: Ein&lt;/font>&lt;/b>"));
          }
          if (stav == "AUS") {
            client.println(F("&lt;b>&lt;font color='red'>Ausgang: Aus&lt;/font>&lt;/b>"));
          }
          client.println(F("&lt;div id=\"countdown\">&lt;/div>"));
          client.print(F("&lt;b>Aktuelle Temperatur des DS18B20-Sensors:&lt;/b> "));
          client.print(teplota);
          client.println(F(" °C"));
          client.print(F("&lt;hr>"));
          client.print(F("&lt;b>Uptime: &lt;/b>"));
          client.print(days);
          client.print(F("d"));
          client.print(F(" "));
          client.print(hours);
          client.print(F("h"));
          client.print(F(" "));
          client.print(minutes);
          client.print(F("m"));
          client.print(F(" "));
          client.print(seconds);
          client.print(F("s"));
          client.println(F("&lt;h3>Autor: Martin Chlebovec - martinius96@gmail.com - https://martinius96.github.io/termostat-ethernet/de/&lt;/h3>"));
          client.println(F("&lt;h4>Freie Version - 1.0.4 build: 18. Sep. 2021&lt;/h4>"));
          client.println(F("&lt;/center>"));
          client.println(F("&lt;/body>"));
          client.println(F("&lt;/html>"));
          delay(1);
          client.stop();
          client.flush();
        } else if (String(request) == "/get_data.json") {
          //PODSTRANKA PRE VYCITANIE DAT (INYM MIKROKONTROLEROM)
          client.println(F("HTTP/1.1 200 OK"));
          client.println(F("Content-Type: application/json"));
          client.println();
          client.println(F("{"));
          client.print(F("\"Hysteresis\":"));
          client.print(read_String(100));
          client.println(F(","));
          client.print(F("\"Target_Temperature\":"));
          client.print(read_String(10));
          client.println(F(","));
          client.print(F("\"Actual_Temperature\":"));
          client.println(String(teplota));
          client.println(F("}"));
          delay(1);
          client.stop();
          client.flush();
        } else if (String(request) == "/favicon.ico") { //fix chybajuceho faviconu
          client.stop();
        } else {
          String myString = String(request);
          if (myString.startsWith("/action.html")) {
            char* parameter;
            char* value;
            char* hodnota1;
            char* hodnota2;
            parameter = strtok(request, terminator3);
            Serial.println(parameter);
            value = strtok(NULL, terminator3);
            hodnota1 = strtok(value, terminator4);
            hodnota2 = strtok(NULL, terminator4);
            char* H_1;
            char* H_2;
            strtok(hodnota1, terminator5);
            H_1 = strtok(NULL, terminator5);
            strtok(hodnota2, terminator5);
            H_2 = strtok(NULL, terminator5);
            String first_param = String(H_1);
            String second_param = String(H_2);
            if (isFloat(first_param)) {
              writeString(10, String(H_1));
            } else {
              Serial.println(F("Benutzereingabe für Taste fname (Zieltemperatur) ist keine Zahl!"));
            }
            if (isFloat(second_param)) {
              writeString(100, String(H_2));
            } else {
              Serial.println(F("Benutzereingabe für Taste fname2 (Hysterese) ist keine Zahl!"));
            }
            client.println(F("HTTP/1.1 200 OK"));
            client.println(F("Content-Type: text/html"));
            client.println();
            client.println(F("&lt;!DOCTYPE html>"));
            client.println(F("&lt;html>"));
            client.println(F("&lt;head>"));
            client.println(F("&lt;meta charset='utf-8'>"));
            client.println(F("&lt;meta http-equiv='Refresh' content='5; url=/' />"));
            client.println(F("&lt;title>HTTP webserver - Arduino + Ethernet&lt;/title>"));
            client.println(F("&lt;/head>"));
            client.println(F("&lt;body>"));
            client.println(F("&lt;center>&lt;h3>Der Server hat Daten vom Formular erhalten:&lt;/h3>"));
            if (!isFloat(second_param) || !isFloat(second_param)) {
              client.println(F("&lt;h3>&lt;font color='red'>Eingegebene Daten sind keine Zahlen !!! Bitte versuchen Sie es nach der Umleitung erneut.&lt;/font>&lt;/h3>"));
            } else {
              client.println("&lt;li>&lt;b>Referenčná teplota: &lt;/b>" + String(H_1) + "&lt;/li>");
              client.println("&lt;li>&lt;b>Hysteréza: &lt;/b>" + String(H_2) + "&lt;/li>");
            }
            client.println(F("&lt;b>Umleitung ... Bitte warten&lt;/b>&lt;/center>"));
            client.println(F("&lt;/body>"));
            client.println(F("&lt;/html>"));
            delay(1);
            client.stop();
            client.flush();
          } else {
            client.println(F("HTTP/1.1 404 Not Found"));
            client.println();
            delay(1);
            client.stop();
            client.flush();
          }
        }
      }
    }
  }
}

</code>
</pre>
<p style="text-align: justify;">
Die Implementierung enthält Programme für die dem Ethernet-Shield zugewiesene statische / dynamische IPv4-Adresse.
<b>Der Thermostat ist nur für Innentemperaturen gedacht!</b> (über 0°C), an die die Systemlogik angepasst ist!
Der Thermostat kann verwendet werden, um einen vorhandenen Raumthermostat zu ersetzen, die Heizung im Aquarium / Terrarium kann vorübergehend ersetzt werden, um eine konstante Temperatur zu halten.
</p>	
 </div>
		</div>
</div>
</body>
        <script>
$(document).ready(function(){
  $('[data-toggle="tooltip2"]').tooltip();   
});
</script>
</html>
